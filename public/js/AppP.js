(function(){var LinMap,LinMapLimitX,cloneObject,limitMax,limitMin,limitMinMax,removeChildren;limitMin=function(x,min){if(x<min){return min}else{return x}};limitMax=function(x,max){if(x>max){return max}else{return x}};limitMinMax=function(x,min,max){if(x<min){return min}else if(x>max){return max}else{return x}};cloneObject=function(obj){var copy,key,value;copy={};for(key in obj){value=obj[key];copy[key]=value}return copy};removeChildren=function(node){var e;while((e=node.firstChild)!=null){node.removeChild(e)}};LinMap=function(){function LinMap(x0,x1,y0,y1){this.x0=x0;this.x1=x1;this.y0=y0;this.y1=y1;this.a=(this.y1-this.y0)/(this.x1-this.x0);this.b=this.y0-this.a*this.x0}LinMap.prototype.y=function(x){return this.a*x+this.b};return LinMap}();LinMapLimitX=function(){function LinMapLimitX(x0,x1,y0,y1){this.x0=x0;this.x1=x1;this.y0=y0;this.y1=y1;this.a=(this.y1-this.y0)/(this.x1-this.x0);this.b=this.y0-this.a*this.x0}LinMapLimitX.prototype.y=function(x){if(x<this.x0){return this.y0}else if(x>this.x1){return this.y1}else{return this.a*x+this.b}};return LinMapLimitX}();window.MiscUtils={limitMin:limitMin,limitMax:limitMax,limitMinMax:limitMinMax,cloneObject:cloneObject,removeChildren:removeChildren,LinMap:LinMap,LinMapLimitX:LinMapLimitX}}).call(this);(function(){var DAY,DAYS_OF_MON,HOUR,MIN,SEC,WEEK,YMD,YMDH,YMDHM,YMDHMS,ceil,ceilDay,ceilHour,ceilMin,ceilSec,daysOfMon,daysOfYear,floor,floorDay,floorHour,floorMin,floorSec,isLeapYear,iso8601,round,roundDay,roundHour,roundMin,roundSec,sNN,sameDay,sameHour,sameMon,sameSec,sameYear;floor=Math.floor;ceil=Math.ceil;round=Math.round;SEC=1e3;MIN=60*SEC;HOUR=60*MIN;DAY=24*HOUR;WEEK=7*DAY;DAYS_OF_MON=[[31,28,31,30,31,30,31,31,30,31,30,31],[31,29,31,30,31,30,31,31,30,31,30,31]];isLeapYear=function(y){return y%400===0||y%100!==0&&y%4===0};daysOfYear=function(y){if(isLeapYear(y)){return 366}else{return 365}};daysOfMon=function(y,m){return DAYS_OF_MON[Number(isLeapYear(y))][m-1]};YMD=function(y,m,d){return new Date(y,m-1,d)};YMDH=function(y,m,d,h){return new Date(y,m-1,d,h)};YMDHM=function(y,m,d,h,min){return new Date(y,m-1,d,h,min)};YMDHMS=function(y,m,d,h,min,s){return new Date(y,m-1,d,h,min,s)};iso8601=function(s){var re;if($.type(s)!=="string"){return}re=s.match(/^(\d{4})-(\d\d)-(\d\d)$/);if(re==null){return}return YMD(parseInt(re[1]),parseInt(re[2]),parseInt(re[3]))};floorSec=function(d){return new Date(floor(+d/SEC)*SEC)};ceilSec=function(d){return new Date(ceil(+d/SEC)*SEC)};roundSec=function(d){return new Date(round(+d/SEC)*SEC)};floorMin=function(d){return new Date(floor(+d/MIN)*MIN)};ceilMin=function(d){return new Date(ceil(+d/MIN)*MIN)};roundMin=function(d){return new Date(round(+d/MIN)*MIN)};floorHour=function(d){var tz;tz=d.getTimezoneOffset()*MIN;return new Date(floor((+d-tz)/HOUR)*HOUR+tz)};ceilHour=function(d){var tz;tz=d.getTimezoneOffset()*MIN;return new Date(ceil((+d-tz)/HOUR)*HOUR+tz)};roundHour=function(d){var tz;tz=d.getTimezoneOffset()*MIN;return new Date(round((+d-tz)/HOUR)*HOUR+tz)};floorDay=function(d){var tz;tz=d.getTimezoneOffset()*MIN;return new Date(floor((+d-tz)/DAY)*DAY+tz)};ceilDay=function(d){var tz;tz=d.getTimezoneOffset()*MIN;return new Date(ceil((+d-tz)/DAY)*DAY+tz)};roundDay=function(d){var tz;tz=d.getTimezoneOffset()*MIN;return new Date(round((+d-tz)/DAY)*DAY+tz)};sameYear=function(a,b){return a.year()===b.year()};sameMon=function(a,b){return a.year()===b.year()&&a.mon()===b.mon()};sameDay=function(a,b){return a.year()===b.year()&&a.mon()===b.mon()&&a.day()===b.day()};sameHour=function(a,b){return a.year()===b.year()&&a.mon()===b.mon()&&a.day()===b.day()&&a.hour()===b.hour()};sameSec=function(a,b){return a.year()===b.year()&&a.mon()===b.mon()&&a.day()===b.day()&&a.hour()===b.hour()&&a.sec()===b.sec()};Date.SEC=SEC;Date.MIN=MIN;Date.HOUR=HOUR;Date.DAY=DAY;Date.WEEK=WEEK;Date.DAYS_OF_MON=DAYS_OF_MON;Date.isLeapYear=isLeapYear;Date.daysOfYear=daysOfYear;Date.daysOfMon=daysOfMon;Date.YMD=YMD;Date.YMDH=YMDH;Date.YMDHM=YMDHM;Date.YMDHMS=YMDHMS;Date.iso8601=iso8601;Date.floorSec=floorSec;Date.ceilSec=ceilSec;Date.roundSec=roundSec;Date.floorMin=floorMin;Date.ceilMin=ceilMin;Date.roundMin=roundMin;Date.floorHour=floorHour;Date.ceilHour=ceilHour;Date.roundHour=roundHour;Date.floorDay=floorDay;Date.ceilDay=ceilDay;Date.roundDay=roundDay;Date.sameYear=sameYear;Date.sameMon=sameMon;Date.sameDay=sameDay;Date.sameHour=sameHour;Date.prototype.sameSec=sameSec;Date.prototype.year=Date.prototype.getFullYear;Date.prototype.mon=function(){return this.getMonth()+1};Date.prototype.wday=Date.prototype.getDay;Date.prototype.day=Date.prototype.getDate;Date.prototype.hour=Date.prototype.getHours;Date.prototype.min=Date.prototype.getMinutes;Date.prototype.sec=Date.prototype.getSeconds;Date.prototype.msec=Date.prototype.getMilliseconds;Date.prototype.isLeapYear=function(){return isLeapYear(this.year())};Date.prototype.daysOfYear=function(){return daysOfYear(this.year())};Date.prototype.daysOfMon=function(){return daysOfMon(this.year(),this.mon())};Date.prototype.floorDay=function(){return floorDay(this)};Date.prototype.ceilDay=function(){return ceilDay(this)};Date.prototype.roundDay=function(){return roundDay(this)};Date.prototype.floorHour=function(){return floorHour(this)};Date.prototype.ceilHour=function(){return ceilHour(this)};Date.prototype.roundHour=function(){return roundHour(this)};Date.prototype.floorMin=function(){return floorMin(this)};Date.prototype.ceilMin=function(){return ceilMin(this)};Date.prototype.roundMin=function(){return roundMin(this)};Date.prototype.floorSec=function(){return floorSec(this)};Date.prototype.ceilSec=function(){return ceilSec(this)};Date.prototype.roundSec=function(){return roundSec(this)};Date.prototype.nextYear=function(dy){var d,date,days;if(dy==null){dy=1}date=new Date(+this);date.setDate(1);date.setFullYear(this.year()+dy);d=this.day();days=date.daysOfMon();if(d>days){d=days}date.setDate(d);return date};Date.prototype.prevYear=function(dy){if(dy==null){dy=1}return this.nextYear(-dy)};Date.prototype.nextMon=function(dm){var d,date,days;if(dm==null){dm=1}date=new Date(+this);date.setDate(1);date.setMonth(this.getMonth()+dm);d=this.day();days=date.daysOfMon();if(d>days){d=days}date.setDate(d);return date};Date.prototype.prevMon=function(dm){if(dm==null){dm=1}return this.nextMon(-dm)};Date.prototype.nextDay=function(dd){var date;if(dd==null){dd=1}date=new Date(+this);date.setDate(date.getDate()+dd);return date};Date.prototype.prevDay=function(dm){if(dm==null){dm=1}return this.nextDay(-dm)};Date.prototype.nextHour=function(dh){if(dh==null){dh=1}return Date.YMDH(this.year(),this.mon(),this.day(),this.hour()+dh)};Date.prototype.prevHour=function(dh){if(dh==null){dh=1}return this.nextHour(-dh)};Date.prototype.nextMin=function(dm){if(dm==null){dm=1}return Date.YMDHM(this.year(),this.mon(),this.day(),this.hour(),this.min()+dm)};Date.prototype.prevMin=function(dm){if(dm==null){dm=1}return this.nextHour(-dm)};Date.prototype.nextSec=function(ds){if(ds==null){ds=1}return Date.YMDHMS(this.year(),this.mon(),this.day(),this.hour(),this.min(),this.sec+ds)};Date.prototype.prevSec=function(ds){if(ds==null){ds=1}return this.nextHour(-ds)};Date.prototype.sameYear=function(d){return sameYear(this,d)};Date.prototype.sameMon=function(d){return sameMon(this,d)};Date.prototype.sameDay=function(d){return sameDay(this,d)};Date.prototype.sameHour=function(d){return sameHour(this,d)};Date.prototype.sameSec=function(d){return sameSec(this,d)};sNN=function(n){if(n<10){return"0"+n}else{return""+n}};Date.prototype.toString=function(){var sign,tz;tz=this.getTimezoneOffset();if(tz<0){tz=-tz;sign="+"}else{sign="-"}return this.year()+"-"+sNN(this.mon())+"-"+sNN(this.day())+" "+sNN(this.hour())+":"+sNN(this.sec())+":"+sNN(this.msec()/10<<0)+" ("+sign+sNN(tz/60<<0)+":"+sNN(tz%60)+")"}}).call(this);(function(){var WIND_DIRECTION,ceilHour,floorHour,limitMinMax,roundHour,timeMax,timeMin;limitMinMax=MiscUtils.limitMinMax;timeMin=function(){var d;d=DataInfo.hourly.firstDay;return Date.YMDH(d.year(),d.mon(),d.day(),1)};timeMax=function(){var d;d=DataInfo.hourly.lastDay;return Date.YMDH(d.year(),d.mon(),d.day(),24)};floorHour=function(d){return limitMinMax(d.floorHour(),timeMin(),timeMax())};ceilHour=function(d){return limitMinMax(d.ceilHour(),timeMin(),timeMax())};roundHour=function(d){return limitMinMax(d.roundHour(),timeMin(),timeMax())};WIND_DIRECTION=["北","北北東","北東","東北東","東","東南東","南東","南南東","南","南南西","南西","西南西","西","西北西","北西","北北西","静穏"];DataInfo.timeMin=timeMin;DataInfo.timeMax=timeMax;DataInfo.floorHour=floorHour;DataInfo.ceilHour=ceilHour;DataInfo.roundHour=roundHour;DataInfo.WIND_DIRECTION=WIND_DIRECTION}).call(this);(function(){window.Pref={platform:"pc",W_GRADATION_DISPLAY:200,W_GRAPH_VIEW:520,H_GRAPH_VIEW:320}}).call(this);(function(){window.GoogleMapsDefaults={LatMin:-85,LatMax:85,LonMin:-180,LonMax:180,ZoomMin:1,ZoomMax:17,lat:37,lon:137,zoom:5,type:google.maps.MapTypeId.ROADMAP}}).call(this);(function(){var Button,CLASS_BUTTON,CLASS_FRAME,CLASS_HR,CLASS_RADIO,CLASS_ROW,CLASS_SELECT,CLASS_SPACER_PREFIX,CLASS_STATIC,CLASS_SUBFRAME,CLASS_SUBROW,CLASS_TABLE,CLASS_TBODY,CLASS_TD,CLASS_TEXT,CLASS_TH,CLASS_TR,Element,Frame,HR,Option,RadioButton,RadioGroup,Row,Select,Spacer,Static,Subframe,Subrow,TBody,TD,TH,TR,Table,Text,Widget,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;CLASS_FRAME="gmw-frame";CLASS_ROW="gmw-row";CLASS_SUBFRAME="gmw-subframe";CLASS_SUBROW="gmw-subrow";CLASS_HR="gmw-hr";CLASS_SPACER_PREFIX="gmw-spacer-";CLASS_TEXT="gmw-text";CLASS_STATIC={normal:"gmw-static-n",grayed:"gmw-static-g"};CLASS_BUTTON={regular:{normal:"gmw-button-r-n",grayed:"gmw-button-r-g",pressed:"gmw-button-r-p"},highlight:{normal:"gmw-button-h-n",grayed:"gmw-button-h-g",pressed:"gmw-button-h-p"}};CLASS_RADIO={left:{regular:{normal:"gmw-radio-l-r-n",grayed:"gmw-radio-l-r-g",pressed:"gmw-radio-l-r-p"},highlight:{normal:"gmw-radio-l-h-n",grayed:"gmw-radio-l-h-g",pressed:"gmw-radio-l-h-p"}},middle:{regular:{normal:"gmw-radio-m-r-n",grayed:"gmw-radio-m-r-g",pressed:"gmw-radio-m-r-p"},highlight:{normal:"gmw-radio-m-h-n",grayed:"gmw-radio-m-h-g",pressed:"gmw-radio-m-h-p"}},right:{regular:{normal:"gmw-radio-r-r-n",grayed:"gmw-radio-r-r-g",pressed:"gmw-radio-r-r-p"},highlight:{normal:"gmw-radio-r-h-n",grayed:"gmw-radio-r-h-g",pressed:"gmw-radio-r-h-p"}}};CLASS_SELECT="gmw-select";CLASS_TABLE="gmw-table";CLASS_TBODY="gmw-tbody";CLASS_TR="gmw-tr";CLASS_TH="gmw-th";CLASS_TD={left:{regular:"gmw-tdl",highlight:"gmw-tdl-h"},center:{regular:"gmw-tdc",highlight:"gmw-tdc-h"},right:{regular:"gmw-tdr",highlight:"gmw-tdr-h"}};Element=function(){function Element(tag,parent,klass){this.elem=document.createElement(tag);if(parent!=null){parent.appendChild(this.elem)}if(klass!=null){this.setClass(klass)}this.bounds={};this}Element.prototype.getElement=function(){return this.elem};Element.prototype.appendChild=function(elem){if(elem instanceof Element){elem=elem.getElement()}this.elem.appendChild(elem);return this};Element.prototype.removeChild=function(elem){if(elem instanceof Element){elem=elem.getElement()}this.elem.removeChild(elem);return this};Element.prototype.replaceChild=function(rem,add){if(rem instanceof Element){rem=rem.getElement()}if(add instanceof Element){add=add.getElement()}this.elem.replaceChild(rem,add);return this};Element.prototype.setClass=function(klass){if(klass!=null){this.elem.className=klass}return this};Element.prototype.addClass=function(klass){var classes;classes=this.elem.className.split(" ");if(classes.indexOf(klass)===-1){classes.push(klass);this.elem.className=classes.join(" ")}return this};Element.prototype.removeClass=function(klass){var classes,i;classes=this.elem.className.split(" ");if((i=classes.indexOf(klass))!==-1){classes.splice(i,1);this.elem.className=classes.join(" ")}return this};Element.prototype.setText=function(text){if(text!=null){this.elem.innerHTML=text}return this};Element.prototype.setTitle=function(title){if(title!=null){this.elem.title=title}return this};Element.prototype.bind=function(event,handler){if(!this.bounds[event]){this.bounds[event]=google.maps.event.addDomListener(this.elem,event,handler)}return this};Element.prototype.unbind=function(event){if(this.bounds[event]){google.maps.event.removeListener(this.bounds[event]);delete this.bounds[event]}return this};return Element}();Spacer=function(superClass){extend(Spacer,superClass);function Spacer(parent,width){Spacer.__super__.constructor.call(this,"span",parent,CLASS_SPACER_PREFIX+width)}return Spacer}(Element);Widget=function(superClass){extend(Widget,superClass);function Widget(parent,klass){Widget.__super__.constructor.call(this,"span",parent,klass);this.stat="normal";this}Widget.prototype.state=function(){return this.stat};Widget.prototype.setState=function(stat){this.stat=stat;this.setClass(this.stateToClass()[this.stat]);return this};return Widget}(Element);Text=function(superClass){extend(Text,superClass);function Text(parent,text){Text.__super__.constructor.call(this,"span",parent,CLASS_TEXT);this.setText(text)}return Text}(Element);Static=function(superClass){extend(Static,superClass);function Static(parent,text){Static.__super__.constructor.apply(this,arguments);this.setText(text);this.setState("normal");this}Static.prototype.stateToClass=function(){return CLASS_STATIC};return Static}(Widget);Button=function(superClass){extend(Button,superClass);function Button(parent,text,title,onClick1){this.onClick=onClick1;this.hi="regular";Button.__super__.constructor.apply(this,arguments);this.elem.draggable=false;this.setText(text);this.setTitle(title);this.enable(true);this}Button.prototype.highlight=function(){return this.hi};Button.prototype.setHighlight=function(hi){this.hi=hi;this.setState(this.stat);return this};Button.prototype.stateToClass=function(){return CLASS_BUTTON[this.hi]};Button.prototype.enable=function(onOff){if(onOff){this.bind("mousedown",function(_this){return function(event){return _this.mousedown(event)}}(this));this.bind("mouseout",function(_this){return function(event){return _this.mouseout(event)}}(this));this.bind("click",function(_this){return function(event){return _this.click(event)}}(this));this.setState("normal")}else{this.unbind("mousedown");this.unbind("mouseout");this.unbind("click");this.setState("grayed")}return this};Button.prototype.mousedown=function(event){return this.setState("pressed")};Button.prototype.mouseout=function(event){return this.setState("normal")};Button.prototype.click=function(event){this.setState("normal");if(this.onClick!=null){return this.onClick(this)}};return Button}(Widget);RadioButton=function(superClass){extend(RadioButton,superClass);function RadioButton(parent,text,title,onClick){this.style="middle";RadioButton.__super__.constructor.apply(this,arguments)}RadioButton.prototype.setStyle=function(style){this.style=style;return this};RadioButton.prototype.stateToClass=function(){return CLASS_RADIO[this.style][this.hi]};return RadioButton}(Button);RadioGroup=function(){function RadioGroup(parent1,handler1){this.parent=parent1;this.handler=handler1;this.buttons=[];this.sel=null;this}RadioGroup.prototype.bind=function(handler1){this.handler=handler1};RadioGroup.prototype.add=function(text,title){var button;if(title==null){title=text}button=new RadioButton(this.parent,text,title,function(_this){return function(b){return _this.click(b)}}(this));button.index=this.buttons.length;this.buttons.push(button);return this};RadioGroup.prototype.finalize=function(sel){if(sel==null){sel=0}if(this.buttons.length<2){throw"RadioGroup: at least 2 buttons needed"}this.buttons[0].setStyle("left");this.buttons[this.buttons.length-1].setStyle("right");this.select(sel);return this};RadioGroup.prototype.click=function(b){this.select(b.index);if(this.handler){return this.handler(b.index)}};RadioGroup.prototype.selected=function(){return this.sel};RadioGroup.prototype.select=function(sel){this.sel=sel;return this.update()};RadioGroup.prototype.update=function(){var i,j,ref;for(i=j=0,ref=this.buttons.length;0<=ref?j<ref:j>ref;i=0<=ref?++j:--j){this.buttons[i].setHighlight(i===this.sel?"highlight":"regular")}return this};RadioGroup.prototype.enable=function(ena){var button,j,len,ref;ref=this.buttons;for(j=0,len=ref.length;j<len;j++){button=ref[j];button.enable(ena)}return this};return RadioGroup}();Option=function(superClass){extend(Option,superClass);function Option(parent,text,value){Option.__super__.constructor.call(this,"option",parent);this.setText(text);this.elem.value=value.toString();this}return Option}(Element);Select=function(superClass){extend(Select,superClass);function Select(parent,handler){Select.__super__.constructor.call(this,"select",parent,CLASS_SELECT);if(handler){this.bind("change",handler)}}Select.prototype.options=function(){return this.elem.children};Select.prototype.length=function(){return this.elem.children.length};Select.prototype.clear=function(){this.elem.innerHTML="";return this};Select.prototype.add=function(text,value){new Option(this,text,value);return this};Select.prototype.select=function(value){var i,iSel,j,ref;value=value.toString();iSel=-1;for(i=j=0,ref=this.elem.children.length;0<=ref?j<ref:j>ref;i=0<=ref?++j:--j){if(this.elem.children[i].value===value){iSel=i;break}}if(iSel!==-1){this.elem.selectedIndex=iSel}return this};Select.prototype.enable=function(onOff){this.elem.disabled=!onOff;return this};Select.prototype.value=function(index){if(index==null){index=null}if(index==null){index=this.elem.selectedIndex}return this.elem.children[index].value};return Select}(Element);TH=function(superClass){extend(TH,superClass);function TH(parent,text){TH.__super__.constructor.call(this,"th",parent,CLASS_TH);if(text!=null){this.setText(text)}}return TH}(Element);TD=function(superClass){extend(TD,superClass);function TD(parent,text,align1){this.align=align1!=null?align1:"left";this.hi="regular";TD.__super__.constructor.call(this,"td",parent,CLASS_TD[this.align][this.hi]);if(text!=null){this.setText(text)}}TD.prototype.highlight=function(){return this.hi};TD.prototype.setHighlight=function(hi){this.hi=hi;return this.setClass(CLASS_TD[this.align][this.hi])};return TD}(Element);TR=function(superClass){extend(TR,superClass);function TR(parent){TR.__super__.constructor.call(this,"tr",parent,CLASS_TR)}TR.prototype.addTH=function(text){return new TH(this,text)};TR.prototype.addTD=function(text,align){return new TD(this,text,align)};TR.prototype.addTDL=function(text){return new TD(this,text,"left")};TR.prototype.addTDC=function(text){return new TD(this,text,"center")};TR.prototype.addTDR=function(text){return new TD(this,text,"right")};return TR}(Element);TBody=function(superClass){extend(TBody,superClass);function TBody(parent){TBody.__super__.constructor.call(this,"tbody",parent,CLASS_TBODY)}TBody.prototype.addTR=function(){var tr;return tr=new TR(this)};return TBody}(Element);Table=function(superClass){extend(Table,superClass);function Table(parent){Table.__super__.constructor.call(this,"table",parent,CLASS_TABLE);this.tbody=new TBody(this)}Table.prototype.addTR=function(){return this.tbody.addTR()};return Table}(Element);Row=function(superClass){extend(Row,superClass);function Row(parent){Row.__super__.constructor.call(this,"div",parent,CLASS_ROW)}Row.prototype.addSpacer=function(width){return new Spacer(this,width)};Row.prototype.addText=function(text){return new Text(this,text)};Row.prototype.addStatic=function(text){return new Static(this,text)};Row.prototype.addButton=function(text,title,onClick){return new Button(this,text,title,onClick)};Row.prototype.addRadioGroup=function(handler){return new RadioGroup(this,handler)};Row.prototype.addSelect=function(handler){return new Select(this,handler)};return Row}(Element);Subrow=function(superClass){extend(Subrow,superClass);function Subrow(parent){Subrow.__super__.constructor.apply(this,arguments);this.setClass(CLASS_SUBROW)}return Subrow}(Row);HR=function(superClass){extend(HR,superClass);function HR(parent){HR.__super__.constructor.call(this,"div",parent,CLASS_HR)}return HR}(Element);Subframe=function(superClass){extend(Subframe,superClass);function Subframe(parent){Subframe.__super__.constructor.call(this,"div",parent,CLASS_SUBFRAME)}Subframe.prototype.addRow=function(){return new Subrow(this)};Subframe.prototype.addHR=function(){return new HR(this)};Subframe.prototype.addSubframe=function(){return new Subframe(this)};return Subframe}(Element);Frame=function(superClass){extend(Frame,superClass);function Frame(){Frame.__super__.constructor.call(this,null);this.setClass(CLASS_FRAME);this.bind("click",function(event){return event.stopPropagation()});this.bind("mousemove",function(event){return event.stopPropagation()})}Frame.prototype.addRow=function(){return new Row(this)};return Frame}(Subframe);window.GoogleMapsWidget={Element:Element,Spacer:Spacer,Widget:Widget,Static:Static,Text:Text,Button:Button,RadioButton:RadioButton,RadioGroup:RadioGroup,Select:Select,Table:Table,TBody:TBody,TR:TR,TH:TH,TD:TD,Row:Row,Subrow:Subrow,HR:HR,Subframe:Subframe,Frame:Frame}}).call(this);(function(){var CsvParser;CsvParser=function(){function CsvParser(input){this.data=input.split(",")}CsvParser.prototype.get_i=function(){var s;s=this.data.shift();if(s.length===0){return null}else{return parseInt(s)}};CsvParser.prototype.get_f=function(){var s;s=this.data.shift();if(s.length===0){return null}else{return parseFloat(s)}};return CsvParser}();window.CsvParser=CsvParser}).call(this);(function(){var DATAINFO_PATH,INTERVAL_ON_DONE,INTERVAL_ON_FAIL,UpdateNotifier,checkUpdate,notifier,updateData;DATAINFO_PATH="data/datainfo";INTERVAL_ON_DONE=60*60*1e3;INTERVAL_ON_FAIL=1*60*1e3;UpdateNotifier=function(){function UpdateNotifier(){this.handlers=[]}UpdateNotifier.prototype.add=function(handler){return this.handlers.push(handler)};UpdateNotifier.prototype.notify=function(){var handler,i,len,ref,results;ref=this.handlers;results=[];for(i=0,len=ref.length;i<len;i++){handler=ref[i];results.push(handler())}return results};return UpdateNotifier}();notifier=new UpdateNotifier;updateData=function(data){var first,hourly,i,last,len,line,re,ref;ref=data.split("\n");for(i=0,len=ref.length;i<len;i++){line=ref[i];if((re=data.match(/firstdayhourly:\s*(.*)/))!=null){first=Date.iso8601(re[1])}if((re=data.match(/lastdayhourly:\s*(.*)/))!=null){last=Date.iso8601(re[1])}}if(first!=null&&last!=null){hourly=DataInfo.hourly;if(first<hourly.firstDay||hourly.lastDay<last){hourly.firstDay=first;hourly.lastDay=last;return notifier.notify()}}};checkUpdate=function(){var promise;promise=$.get(DATAINFO_PATH);promise.done(function(_this){return function(data){updateData(data);return setTimeout(checkUpdate,INTERVAL_ON_DONE)}}(this));return promise.fail(function(_this){return function(data){console.log(new Date+": Cannot load: "+DATAINFO_PATH);return setTimeout(checkUpdate,INTERVAL_ON_FAIL)}}(this))};setTimeout(checkUpdate,INTERVAL_ON_DONE);window.UpdateChecker={add:function(handler){return notifier.add(handler)}}}).call(this);(function(){var LatMax,LatMin,LonMax,LonMin,RE_KEY_VALUE,ZoomMax,ZoomMin,clone,gmDefaults,location,parseHash,parseOption,parseQuery,parseUrlOption,processGoogleMapsOption;clone=MiscUtils.cloneObject;RE_KEY_VALUE=/(.+)=(.*)/;location=window.location;parseOption=function(string,option){var i,keyValue,len,re,ref;if(option==null){option={}}ref=string.toLowerCase().split("&");for(i=0,len=ref.length;i<len;i++){keyValue=ref[i];if((re=keyValue.match(RE_KEY_VALUE))!=null){option[re[1]]=re[2]}}return option};parseQuery=function(option){if(option==null){option={}}return parseOption(location.search.substring(1),option)};parseHash=function(option){if(option==null){option={}}return parseOption(location.hash.substring(1),option)};parseUrlOption=function(option){if(option==null){option={}}return parseHash(parseQuery(option))};gmDefaults=window.GoogleMapsDefaults;LatMin=gmDefaults.LatMin;LatMax=gmDefaults.LatMax;LonMin=gmDefaults.LonMin;LonMax=gmDefaults.LonMax;ZoomMin=gmDefaults.ZoomMin;ZoomMax=gmDefaults.ZoomMax;processGoogleMapsOption=function(option,gmOption){var key,lat,latLon,lon,value,zoom;if(gmOption==null){gmOption=clone(gmDefaults)}for(key in option){value=option[key];switch(key){case"ll":latLon=value.split(",");if(latLon.length===2){lat=parseFloat(latLon[0]);lon=parseFloat(latLon[1]);if(LatMin<=lat&&lat<=LatMax&&(LonMin<=lon&&lon<=LonMax)){gmOption.lat=lat;gmOption.lon=lon}}break;case"z":zoom=parseInt(value);if(ZoomMin<=zoom&&zoom<=ZoomMax){gmOption.zoom=zoom}break;case"t":gmOption.type=value}}return gmOption};window.OptionParser={parseOption:parseOption,parseQuery:parseQuery,parseHash:parseHash,parseUrlOption:parseUrlOption,processGoogleMapsOption:processGoogleMapsOption}}).call(this);(function(){var CACHE_LIMIT,WeatherModel,cache,queue;CACHE_LIMIT=100;cache={};queue=[];WeatherModel=function(){function WeatherModel(ctl){this.ctl=ctl}WeatherModel.prototype.getData=function(day,hour){var data,key;key=this.key(day,hour/6>>0);data=cache[key];if(this.isData(data)){queue.splice(queue.indexOf(key),1);queue.push(key)}return data};WeatherModel.prototype.isData=function(data){return $.type(data)==="string"};WeatherModel.prototype.isFetching=function(data){return data!=null&&$.type(data)!=="string"};WeatherModel.prototype.xhr=function(day,hour){var index,key,promise;index=hour/6>>0;key=this.key(day,index);if(cache[key]!=null){this.getData(day(hour));return}cache[key]=promise=$.get(this.path(day,index));promise.done(function(_this){return function(data){cache[key]=data;if(queue.length>=CACHE_LIMIT){delete cache[queue.shift()]}queue.push(key);return _this.ctl.xhrDone(day,hour,data)}}(this));return promise.fail(function(_this){return function(xhrObj){delete cache[key];return _this.ctl.xhrFail(day,hour,xhrObj)}}(this))};WeatherModel.prototype.sNN=function(n){if(n<10){return"0"+n}else{return""+n}};WeatherModel.prototype.key=function(d,i){return d.year()+"-"+d.mon()+"-"+d.day()+"-"+i};WeatherModel.prototype.path=function(d,i){return"data/hourly/map/"+d.year()+"/"+this.sNN(d.mon())+this.sNN(d.day())+"/"+i+".csv"};return WeatherModel}();window.WeatherModel=WeatherModel}).call(this);(function(){var NDATA,WeatherDecoder;NDATA=6;WeatherDecoder=function(){function WeatherDecoder(){}WeatherDecoder.prototype.decode=function(input){var d,data,dummy,flags,hasD,hasF,hasL,hasP,hasS,hasT,hasV,i,id,j,k,len,nPlace,p,ref;p=new CsvParser(input);data=function(){var j,ref,results;results=[];for(i=j=0,ref=NDATA;0<=ref?j<ref:j>ref;i=0<=ref?++j:--j){results.push({})}return results}();nPlace=p.get_i();for(dummy=j=0,ref=nPlace;0<=ref?j<ref:j>ref;dummy=0<=ref?++j:--j){id=p.get_i();flags=p.get_i();hasP=(flags&1)!==0;hasT=(flags&2)!==0;hasV=(flags&4)!==0;hasD=(flags&8)!==0;hasL=(flags&16)!==0;hasF=(flags&32)!==0;hasS=(flags&64)!==0;for(k=0,len=data.length;k<len;k++){d=data[k];d[id]=[hasP?p.get_f():null,hasT?p.get_f():null,hasV?p.get_f():null,hasD?p.get_i():null,hasL?p.get_f():null,hasF?p.get_i():null,hasS?p.get_i():null]}}return data};return WeatherDecoder}();window.WeatherDecoder=WeatherDecoder}).call(this);(function(){var WeatherController;WeatherController=function(){function WeatherController(view){if(view==null){view=null}this.model=new WeatherModel(this);this.views=[];this.decoder=new WeatherDecoder;this.day=null;this.hour=null;this.xhrDay=this.xhrHour=null;this.data=null;this.interval=null;this.timer=null;this.firstDay=DataInfo.hourly.firstDay;this.lastDay=DataInfo.hourly.lastDay;UpdateChecker.add(function(_this){return function(){return _this.onUpdateData()}}(this));if(view!=null){this.addView(view)}}WeatherController.prototype.addView=function(v){if(this.views.indexOf(v)===-1){this.views.push(v)}};WeatherController.prototype.removeView=function(v){var i;if((i=this.views.indexOf(v))!==-1){this.views.splice(i,1)}};WeatherController.prototype.getData=function(){if(this.data!=null){return this.data[this.hour%6]}else{return null}};WeatherController.prototype.isLastData=function(){return this.isSameData(this.lastDay,23)};WeatherController.prototype.isLastFrame=function(){return this.isLastData()&&this.hour===23};WeatherController.prototype.getTime=function(){if(this.day){return Date.YMDH(this.day.year(),this.day.mon(),this.day.day(),this.hour+1)}};WeatherController.prototype.setTime=function(t){var d;if($.type(t)==="number"){t=new Date(t)}t=DataInfo.ceilHour(t);d=Date.YMDH(t.year(),t.mon(),t.day(),t.hour()-1);this.requestData(d,d.hour())};WeatherController.prototype.prefetchNextData=function(){var day,hour;if(!this.isLastData()){day=this.day;hour=this.hour+6;if(hour>=24){hour-=24;day=day.nextDay()}if(this.model.getData(day,hour)==null){this.model.xhr(day,hour)}}};WeatherController.prototype.xhrDone=function(day,hour,data){if(this.xhrDay!=null&&this.xhrDay.sameDay(day)&&this.xhrHour===hour){this.setNewData(day,hour,data);if(this.interval){this.setAnim(this.interval,true)}}};WeatherController.prototype.xhrFail=function(day,hour,xhrObj){this.updateViews(false)};WeatherController.prototype.onUpdateData=function(){var j,len,ref,v;this.firstDay=DataInfo.hourly.firstDay;this.lastDay=DataInfo.hourly.lastDay;ref=this.views;for(j=0,len=ref.length;j<len;j++){v=ref[j];v.onUpdateData()}};WeatherController.prototype.setAnim=function(msec,reset){if(reset==null){reset=false}if(!reset&&this.interval===msec){return}this.interval=msec;if(this.timer!=null){clearTimeout(this.timer)}if(this.interval!=null){this.prefetchNextData();this.timer=setTimeout(function(_this){return function(){return _this.onTimer()}}(this),this.interval)}else{this.timer=null}};WeatherController.prototype.onTimer=function(){var data,day,hour;day=this.day;hour=this.hour+1;if(hour%6!==0){this.hour=hour;this.updateViews(true);if(this.isLastFrame()){this.interval=this.timer=null;return}}else{if(hour===24){hour=0;day=day.nextDay()}data=this.model.getData(day,hour);if(this.model.isData(data)){this.setNewData(day,hour,data);this.prefetchNextData()}}this.timer=setTimeout(function(_this){return function(){return _this.onTimer()}}(this),this.interval)};WeatherController.prototype.isSameData=function(d,h){return this.day!=null&&this.day.sameDay(d)&&this.hour/6>>0===h/6>>0};WeatherController.prototype.requestData=function(day,hour){var data;if(this.isSameData(day,hour)){if(this.hour!==hour){this.hour=hour;this.updateViews(true);if(this.interval){this.setAnim(this.interval,true)}}return}data=this.model.getData(day,hour);if(this.model.isData(data)){this.setNewData(day,hour,data);if(this.interval){this.setAnim(this.interval,true)}}else if(!this.model.isFetching(data)){this.xhrDay=day;this.xhrHour=hour;this.model.xhr(day,hour)}};WeatherController.prototype.setNewData=function(day,hour,data){this.day=day;this.hour=hour;this.xhrDay=this.xhrHour=null;this.data=this.decoder.decode(data);this.updateViews(true)};WeatherController.prototype.updateViews=function(success){var j,len,ref,v;ref=this.views;for(j=0,len=ref.length;j<len;j++){v=ref[j];v.update(this,success)}};return WeatherController}();window.WeatherController=WeatherController}).call(this);(function(){var CACHE_LIMIT,TYPE_POSTFIX,TrendModel,cache,queue;CACHE_LIMIT=100;cache={};queue=[];TYPE_POSTFIX={y:"",d:"x",c:"xx"};TrendModel=function(){function TrendModel(ctl){this.ctl=ctl}TrendModel.prototype.getData=function(id,index,type){var data,key;key=this.key(id,index,type);data=cache[key];if(this.isData(data)){queue.splice(queue.indexOf(key),1);queue.push(key)}return data};TrendModel.prototype.isData=function(data){return $.type(data)==="string"};TrendModel.prototype.isFetching=function(data){return data!=null&&$.type(data)!=="string"};TrendModel.prototype.xhr=function(id,index,type){var key,promise;key=this.key(id,index,type);if(cache[key]!=null){this.getData(id,index,type);return}cache[key]=promise=$.get(this.path(id,index,type));promise.done(function(_this){return function(data){cache[key]=data;if(queue.length>=CACHE_LIMIT){delete cache[queue.shift()]}queue.push(key);return _this.ctl.xhrDone(id,index,type,data)}}(this));promise.fail(function(_this){return function(xhrObj){delete cache[key];return _this.ctl.xhrFail(id,index,type,xhrObj)}}(this))};TrendModel.prototype.key=function(id,index,type){if(type==="a"){return id+"-all"}else{return id+"-"+index+TYPE_POSTFIX[type]}};TrendModel.prototype.path=function(id,index,type){if(type==="a"){return"data/hourly/trend/all/"+id+".csv"}else{return"data/hourly/trend/"+index+TYPE_POSTFIX[type]+"/"+id+".csv"}};return TrendModel}();TrendModel.TYPE_POSTFIX=TYPE_POSTFIX;window.TrendModel=TrendModel}).call(this);(function(){var DELTA_TIME,N_DATA_ALL,TrendDecoder,ceil,daysOfYear,max,min,totalDays;ceil=Math.ceil;min=function(x,y){if(x!=null){if(y!=null){if(x<y){return x}else{return y}}else{return x}}else{return y}};max=function(x,y){if(x!=null){if(y!=null){if(x>y){return x}else{return y}}else{return x}}else{return y}};DELTA_TIME=[36e5,72e5,144e5,288e5,432e5,864e5,1728e5,3456e5,6912e5,13824e5,27648e5,55296e5,110592e5];daysOfYear=Date.daysOfYear;totalDays=function(yearFrom,yearTo){var days,j,ref,ref1,year;days=0;for(year=j=ref=yearFrom,ref1=yearTo;ref<=ref1?j<=ref1:j>=ref1;year=ref<=ref1?++j:--j){days+=daysOfYear(year)}return days};N_DATA_ALL=ceil(totalDays(1800,2099)/32);TrendDecoder=function(){function TrendDecoder(){}TrendDecoder.prototype.decode=function(index,type,input){switch(type){case"y":return this.decodeYear(index,input);case"d":return this.decodeDecade(index,input);case"c":return this.decodeCentury(index,input);case"a":return this.decodeAll(input)}};TrendDecoder.prototype.decodeYear=function(year,input){var data,i,j,levels,t0;t0=+Date.YMDH(year,1,1,1);data=this.decodeY(year,input);data.t0=t0;data.dt=DELTA_TIME[0];levels=[data];for(i=j=1;j<=3;i=++j){levels.push(data=this.makeStat(data));data.t0=t0;data.dt=DELTA_TIME[i]}return levels};TrendDecoder.prototype.decodeDecade=function(decade,input){var data,i,j,levels,t0,year;year=decade*10;t0=+Date.YMDH(year,1,1,1);data=this.decodeDCA(totalDays(year,year+9)*2,input);data.t0=t0;data.dt=DELTA_TIME[4];levels=[];levels[4]=data;for(i=j=5;j<=6;i=++j){levels[i]=data=this.makeStat(data);data.t0=t0;data.dt=DELTA_TIME[i]}return levels};TrendDecoder.prototype.decodeCentury=function(century,input){var data,i,j,levels,t0,year;year=century*100;t0=+Date.YMDH(year,1,1,1);data=this.decodeDCA(ceil(totalDays(year,year+99)/4),input);data.t0=t0;data.dt=DELTA_TIME[7];levels=[];levels[7]=data;for(i=j=8;j<=9;i=++j){levels[i]=data=this.makeStat(data);data.t0=t0;data.dt=DELTA_TIME[i]}return levels};TrendDecoder.prototype.decodeAll=function(input){var data,i,j,levels,t0;data=this.decodeDCA(N_DATA_ALL,input);t0=+Date.YMDH(1800,1,1,1);data.t0=t0;data.dt=DELTA_TIME[10];levels=[];levels[10]=data;for(i=j=11;j<=12;i=++j){levels[i]=data=this.makeStat(data);data.t0=t0;data.dt=DELTA_TIME[i]}return levels};TrendDecoder.prototype.decodeY=function(year,input){var c,fd,ff,fl,fp,fs,ft,fv,hour,i,j,k,l,ref,ref1,t,trend;c=new CsvParser(input);ref=this.parseFlags(c.get_i()),fp=ref[0],ft=ref[1],fv=ref[2],fd=ref[3],fl=ref[4],ff=ref[5],fs=ref[6];trend=[];for(i=j=0,ref1=daysOfYear(year);0<=ref1?j<ref1:j>ref1;i=0<=ref1?++j:--j){if(c.get_i()!=null){for(hour=k=0;k<24;hour=++k){trend.push([fp?c.get_f():null,t=ft?c.get_f():null,t,fv?c.get_f():null,fd?c.get_i():null,fl?c.get_f():null,ff?c.get_i():null,fs?c.get_i():null])}}else{for(hour=l=0;l<24;hour=++l){trend.push(null)}}}return trend};TrendDecoder.prototype.decodeDCA=function(nData,input){var c,fd,ff,fl,fp,fs,ft,fv,i,j,ref,ref1,trend;c=new CsvParser(input);ref=this.parseFlags(c.get_i()),fp=ref[0],ft=ref[1],fv=ref[2],fd=ref[3],fl=ref[4],ff=ref[5],fs=ref[6];trend=[];for(i=j=0,ref1=nData;0<=ref1?j<ref1:j>ref1;i=0<=ref1?++j:--j){if(c.get_i()!=null){trend.push([fp?c.get_f():null,ft?c.get_f():null,ft?c.get_f():null,fv?c.get_f():null,fd?c.get_i():null,fl?c.get_f():null,ff?c.get_i():null,fs?c.get_i():null])}else{trend.push(null)}}return trend};TrendDecoder.prototype.parseFlags=function(flags){return[(flags&1)!==0,(flags&2)!==0,(flags&4)!==0,(flags&8)!==0,(flags&16)!==0,(flags&32)!==0,(flags&64)!==0]};TrendDecoder.prototype.makeStat=function(data){var d,dx,dy,fx,fy,i,length,lx,ly,px,py,stat,sx,sy,t0x,t0y,t1x,t1y,v,vx,vy,x,y;stat=[];length=data.length;i=0;while(i<length){if(i===length-1){stat.push(data[i]);return stat}else{x=data[i];y=data[i+1];if(x!=null){if(y!=null){px=x[0],t0x=x[1],t1x=x[2],vx=x[3],dx=x[4],lx=x[5],fx=x[6],sx=x[7];py=y[0],t0y=y[1],t1y=y[2],vy=y[3],dy=y[4],ly=y[5],fy=y[6],sy=y[7];v=d=null;if(vx!=null){if(vy!=null){if(vx>vy){v=vx;d=dx}else{v=vy;d=dy}}else{v=vx;d=dx}}else{v=vy;d=dy}stat.push([max(px,py),min(t0x,t0y),max(t1x,t1y),v,d,max(lx,ly),max(fx,fy),max(sx,sy)])}else{stat.push(x)}}else{stat.push(y)}i+=2}}return stat};return TrendDecoder}();TrendDecoder.DELTA_TIME=DELTA_TIME;window.TrendDecoder=TrendDecoder}).call(this);(function(){var TrendIterator0,TrendIterator1,TrendIterator2;TrendIterator0=function(){function TrendIterator0(id,level,tL,tR){this.id=id;this.level=level;this.tL=tL;this.tR=tR;this.t=this.x=null}TrendIterator0.prototype.reset=function(){};TrendIterator0.prototype.next=function(){};return TrendIterator0}();TrendIterator1=function(){function TrendIterator1(id,level,tL,tR,d,iL,iR){this.id=id;this.level=level;this.tL=tL;this.tR=tR;this.d=d;this.iL=iL;this.iR=iR;this.dt=this.d.dt;this.hasData=true;this.reset()}TrendIterator1.prototype.reset=function(){this.i=this.iL;this.x=this.d[this.iL];return this.t=this.d.t0+this.i*this.dt};TrendIterator1.prototype.next=function(){if(this.i!==this.iR){this.x=this.d[++this.i];return this.t+=this.dt}else{return this.t=this.x=null}};return TrendIterator1}();TrendIterator2=function(){function TrendIterator2(id,level,tL,tR,dL,iL,dR,iR){this.id=id;this.level=level;this.tL=tL;this.tR=tR;this.dL=dL;this.iL=iL;this.dR=dR;this.iR=iR;this.dt=this.dL.dt;this.hasData=true;this.reset()}TrendIterator2.prototype.reset=function(){this.d=this.dL;this.i=this.iL;this.x=this.d[this.i];return this.t=this.d.t0+this.i*this.dt};TrendIterator2.prototype.next=function(){if(this.d===this.dL){if(++this.i!==this.d.length){this.x=this.d[this.i];return this.t+=this.dt}else{this.d=this.dR;this.i=0;this.x=this.d[0];return this.t=this.d.t0}}else{if(this.i!==this.iR){this.x=this.d[++this.i];return this.t+=this.dt}else{return this.t=this.x=null}}};return TrendIterator2}();window.TrendIterator0=TrendIterator0;window.TrendIterator1=TrendIterator1;window.TrendIterator2=TrendIterator2}).call(this);(function(){var CACHE_LIMIT,DELTA_TIME,TYPE_POSTFIX,TrendController,cache,cacheKey,ceil,floor,limitMax,limitMin,limitMinMax,queue;ceil=Math.ceil;floor=Math.floor;limitMin=MiscUtils.limitMin;limitMax=MiscUtils.limitMax;limitMinMax=MiscUtils.limitMinMax;CACHE_LIMIT=50;cache={};queue=[];cacheKey=function(id,index,type){if(type==="a"){return id+"-all"}else{return id+"-"+index+TYPE_POSTFIX[type]}};TYPE_POSTFIX=TrendModel.TYPE_POSTFIX;DELTA_TIME=TrendDecoder.DELTA_TIME;TrendController=function(){function TrendController(view){if(view==null){view=null}this.model=new TrendModel(this);this.views=[];this.decoder=new TrendDecoder;UpdateChecker.add(function(_this){return function(){return _this.onUpdateData()}}(this));if(view!=null){this.addView(view)}}TrendController.prototype.addView=function(v){if(this.views.indexOf(v)===-1){return this.views.push(v)}};TrendController.prototype.removeView=function(v){var i;if((i=this.views.indexOf(v))!==-1){return this.views.splice(i,1)}};TrendController.prototype.requestData=function(id,tL,tR,nData){var dt,level,p;if($.type(tL)==="number"){tL=new Date(tL)}if($.type(tR)==="number"){tR=new Date(tR)}this.pending=p={id:id,tL:tL,tR:tR};dt=(tR-tL)/nData;level=DELTA_TIME.length-1;while(level!==0&&DELTA_TIME[level]>dt){--level}p.level=level;tL=tL.ceilHour().prevHour();tR=tR.ceilHour().prevHour();if(level<4){p.ty="y";p.iL=tL.year();p.iR=tR.year()}else if(level<7){p.ty="d";p.iL=tL.year()/10>>0;p.iR=tR.year()/10>>0}else if(level<10){p.ty="c";p.iL=tL.year()/100>>0;p.iR=tR.year()/100>>0}else{p.ty="a";p.iL=p.iR=0}return this.resolvePending()};TrendController.prototype.xhrDone=function(id,index,type,data){this.setNewData(id,index,type,data);this.resolvePending()};TrendController.prototype.xhrFail=function(id,index,type,xhrObj){if(xhrObj.status===404){this.rescuePending(id,index,type)}else{this.updateViews(false)}};TrendController.prototype.onUpdateData=function(){var j,len,ref,v;ref=this.views;for(j=0,len=ref.length;j<len;j++){v=ref[j];v.onUpdateData()}};TrendController.prototype.resolvePending=function(p){var dL,dR;if(p==null){p=this.pending}if(p!=null&&(dL=this.getData(p.id,p.iL,p.ty))!=null){dR=p.iL===p.iR?dL:this.getData(p.id,p.iR,p.ty);if(dR!=null){this.setIterator(dL,dR)}}};TrendController.prototype.rescuePending=function(id,index,type,p){if(p==null){p=this.pending}if(p!=null&&id===p.id&&type===p.ty){if(index===p.iL){if(p.iL===p.iR){this.setIterator(null)}else{p.iL=p.iR;this.resolvePending()}}else if(index===p.iR){p.iR=p.iL;this.resolvePending()}}};TrendController.prototype.getData=function(id,index,type){var data,input,key;key=cacheKey(id,index,type);if((data=cache[key])!=null){queue.splice(queue.indexOf(key),1);queue.push(key)}else if((input=this.model.getData(id,index,type))!=null){if(this.model.isData(input)){data=this.setNewData(id,index,type,input)}}else{this.model.xhr(id,index,type)}return data};TrendController.prototype.setIterator=function(dL,dR,p){var jL,jR,tLL,tRR;if(p==null){p=this.pending}this.iterator=dL!=null?(tLL=limitMin(p.tL,DataInfo.timeMin()),tRR=limitMax(p.tR,DataInfo.timeMax()),dL=dL[p.level],jL=limitMinMax(ceil((tLL-dL.t0)/dL.dt),0,dL.length-1),p.iL===p.iR?(jR=limitMinMax(ceil((tRR-dL.t0)/dL.dt),0,dL.length-1),new TrendIterator1(p.id,p.level,p.tL,p.tR,dL,jL,jR)):(dR=dR[p.level],jR=limitMinMax(ceil((tRR-dR.t0)/dR.dt),0,dR.length-1),new TrendIterator2(p.id,p.level,p.tL,p.tR,dL,jL,dR,jR))):new TrendIterator0(p.id,p.level,p.tL,p.tR);this.pending=null;this.updateViews(true)};TrendController.prototype.setNewData=function(id,index,type,input){var data,key;key=cacheKey(id,index,type);data=cache[key]=this.decoder.decode(index,type,input);if(queue.length>=CACHE_LIMIT){delete cache[queue.shift()]}queue.push(key);return data};TrendController.prototype.updateViews=function(success){var j,len,ref,v;ref=this.views;for(j=0,len=ref.length;j<len;j++){v=ref[j];v.update(this,success)}};return TrendController}();window.TrendController=TrendController}).call(this);(function(){var GoogleMapsOverlaySvg,Minus90,Plus90,SVGNS,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;window.SVGNS=SVGNS="http://www.w3.org/2000/svg";Minus90=new google.maps.LatLng(0,-90);Plus90=new google.maps.LatLng(0,90);GoogleMapsOverlaySvg=function(superClass){extend(GoogleMapsOverlaySvg,superClass);function GoogleMapsOverlaySvg(canvasId,map,latN,latS,lonW,lonE){this.canvasId=canvasId;this.map=map;this.setMap(this.map);this.nwBound=new google.maps.LatLng(latN,lonW);this.seBound=new google.maps.LatLng(latS,lonE)}GoogleMapsOverlaySvg.prototype.onAdd=function(){var canvas;this.div=document.createElement("div");this.div.style.border="none";this.div.style.borderWidth="0px";this.div.style.position="absolute";this.svg=document.createElementNS(SVGNS,"svg");this.svg.setAttribute("version","1.1");this.svg.setAttribute("xmlns",SVGNS);this.div.appendChild(this.svg);this.overlayDiv=this.getPanes().overlayLayer;this.overlayDiv.appendChild(this.div);canvas=document.getElementById(this.canvasId);canvas.onclick=function(_this){return function(event){return _this.click(event)}}(this);canvas.onmousemove=function(_this){return function(event){return _this.mousemove(event)}}(this);return this};GoogleMapsOverlaySvg.prototype.draw=function(){var minus90,plus90,proj,se,style,w;this.zoom=this.map.getZoom();proj=this.getProjection();minus90=proj.fromLatLngToDivPixel(Minus90);plus90=proj.fromLatLngToDivPixel(Plus90);this.pxEarthW=Math.abs(plus90.x-minus90.x)*2;this.origin=proj.fromLatLngToDivPixel(this.nwBound);se=proj.fromLatLngToDivPixel(this.seBound);w=se.x-this.origin.x;if(w<0){w+=this.pxEarthW}this.svg.setAttribute("width",""+w);this.svg.setAttribute("height",""+(se.y-this.origin.y));style=this.div.style;style.left=this.origin.x+"px";style.top=this.origin.y+"px";return this};GoogleMapsOverlaySvg.prototype.click=function(event){return this.onClick(this.convertMouseCoord(event))};GoogleMapsOverlaySvg.prototype.mousemove=function(event){return this.onMouseMove(this.convertMouseCoord(event))};GoogleMapsOverlaySvg.prototype.onClick=function(point){};GoogleMapsOverlaySvg.prototype.onMouseMove=function(point){};GoogleMapsOverlaySvg.prototype.convertMouseCoord=function(event){var rect;rect=this.overlayDiv.getBoundingClientRect();return new google.maps.Point(event.clientX-rect.left,event.clientY-rect.top)};return GoogleMapsOverlaySvg}(google.maps.OverlayView);window.GoogleMapsOverlaySvg=GoogleMapsOverlaySvg}).call(this);(function(){var MAXZOOM,PrecGrad,PrecGradMax,SnowDepthGrad,SnowDepthGradMax,SnowfallGrad,SnowfallGradMax,SunGrad,TempGrad,TempGradMax,TempOffset,WindPath,WindPathMax,animationInterval,circleScale,dotFill,dotFillGray,dotScale,generateScale,i,log,precGradient,renderWindPath,round,sizeScale,snowDepthGradient,snowfallGradient,sunGradient,tempGradient,windScale;generateScale=function(x0,rx,n){var i,j,ref,results;x0/=rx;results=[];for(i=j=0,ref=n;0<=ref?j<=ref:j>=ref;i=0<=ref?++j:--j){results.push(x0*=rx)}return results};MAXZOOM=22;dotScale=generateScale(.14,1.45,MAXZOOM);circleScale=generateScale(.15,1.7,MAXZOOM);windScale=generateScale(.012,1.7,MAXZOOM);sizeScale=function(){var scale;scale=generateScale(1,1.6,3);scale.unshift(0);return scale}();dotFill="rgba(0,0,0,0.5)";dotFillGray="rgba(0,0,0,0.25)";round=Math.round;log=Math.log;TempGrad=function(){var R2N,b,bank,blend0,blend1,c,c0,c1,g,grad,j,k,r,ref,ref1,ref2,rgb,t,t0,t1;rgb=[{t:-50,r:0,g:0,b:0},{t:-45,r:0,g:0,b:25},{t:-40,r:0,g:0,b:50},{t:-35,r:0,g:0,b:75},{t:-30,r:0,g:0,b:90},{t:-25,r:0,g:0,b:100},{t:-20,r:20,g:20,b:100},{t:-15,r:40,g:40,b:100},{t:-10,r:60,g:60,b:100},{t:-5,r:80,g:80,b:100},{t:0,r:100,g:100,b:100},{t:5,r:50,g:90,b:95},{t:10,r:35,g:85,b:55},{t:15,r:80,g:100,b:35},{t:20,r:90,g:90,b:0},{t:25,r:100,g:75,b:0},{t:30,r:100,g:50,b:0},{t:35,r:100,g:0,b:0},{t:40,r:75,g:0,b:0},{t:45,r:50,g:0,b:0},{t:50,r:25,g:0,b:0}];R2N=255/100;grad=[];for(bank=j=0,ref=rgb.length-1;0<=ref?j<ref:j>ref;bank=0<=ref?++j:--j){c0=rgb[bank];c1=rgb[bank+1];t0=round(c0.t);t1=round(c1.t);for(t=k=ref1=t0,ref2=t1;ref1<=ref2?k<ref2:k>ref2;t=ref1<=ref2?++k:--k){blend1=1*(t-t0)/(t1-t0);blend0=1-blend1;r=round(R2N*(c0.r*blend0+c1.r*blend1));g=round(R2N*(c0.g*blend0+c1.g*blend1));b=round(R2N*(c0.b*blend0+c1.b*blend1));grad.push("rgba("+r+","+g+","+b+",0.5)")}}c=rgb[rgb.length-1];r=round(R2N*c.r);g=round(R2N*c.g);b=round(R2N*c.b);grad.push("rgba("+r+","+g+","+b+",0.5)");return grad}();TempGradMax=TempGrad.length-1;TempOffset=50;tempGradient=function(t){if(t!=null){if((t=round(t+TempOffset))<0){t=0}else if(t>TempGradMax){t=TempGradMax}return TempGrad[t]}else{return"none"}};PrecGrad=function(){var a,b,g,grad,i,j,r;grad=["rgba(60,120,255,0)"];for(i=j=1;j<=400;i=++j){r=60-i*.15;g=120-i*.3;b=255-i*.45;a=log(i+1)*.15;grad.push("rgba("+round(r)+","+round(g)+","+round(b)+","+a.toFixed(3)+")")}return grad}();PrecGradMax=PrecGrad.length-1;precGradient=function(p){if(p!=null){if((p=round(2*p))>PrecGradMax){p=PrecGradMax}return PrecGrad[p]}else{return"none"}};SunGrad=function(){var grad,i,j;grad=["rgba(255,120,0,0)"];for(i=j=1;j<=10;i=++j){grad.push("rgba(255,120,0,"+(i*.075).toFixed(3)+")")}return grad}();sunGradient=function(s){return SunGrad[round(s*10)]||"none"};SnowfallGrad=function(){var i,results,x;i=0;results=[];while(i<PrecGrad.length){x=PrecGrad[i];i+=10;results.push(x)}return results}();SnowfallGradMax=SnowfallGrad.length-1;snowfallGradient=function(f){if(f!=null){if((f=round(f))>SnowfallGradMax){f=SnowfallGradMax}return SnowfallGrad[f]}else{return"none"}};SnowDepthGrad=PrecGrad;SnowDepthGradMax=SnowDepthGrad.length-1;snowDepthGradient=function(d){var f;if(d!=null){if((d=round(.5*d))>SnowDepthGradMax){f=SnowDepthGradMax}return SnowDepthGrad[d]}else{return"none"}};WindPath=function(){var j,results;results=[];for(i=j=0;j<=500;i=++j){results.push("M0,"+(i*.4).toFixed(1)+"L4,0L-4,0Z")}return results}();WindPathMax=WindPath.length-1;renderWindPath=function(v){if(v!=null){if((v=v*10>>0)>WindPathMax){v=WindPathMax}return WindPath[v]}else{return"M0,0"}};animationInterval=generateScale(1e3,.5,4);window.Presentation={generateScale:generateScale,scale:{dot:dotScale,circle:circleScale,wind:windScale,size:sizeScale},fill:{dot:{regular:dotFill,grayed:dotFillGray}},gradient:{temp:tempGradient,prec:precGradient,sun:sunGradient,fall:snowfallGradient,depth:snowDepthGradient},path:{wind:{fill:"rgba(0,0,150,0.35)",stroke:"rgba(0,0,150,0.25)",strokeWidth:"3",strokeLineCap:"round",strokeLineJoin:"round",render:renderWindPath}},animation:{interval:animationInterval}}}).call(this);(function(){var DisplayFrame,GRADIENT,GradationDisplay,GradientDisplay,H_GRAD,H_GRADFRAME,H_LINE,H_WINDFRAME,LN_10,MARGIN,RE_SVGA_ALPHA,SVGNS,ScaleDisplay,W_GRAD,W_GRADFRAME,W_WIND,W_WINDFRAME,Y_GRAD,Y_LINE,Y_TEXT,fracDigits,log,scaleStep,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;log=Math.log;LN_10=1/Math.LN10;scaleStep=function(w){var e10,log10,p10,r,step;log10=log(w)*LN_10;e10=Math.floor(log10);p10=Math.pow(10,e10);r=w/p10;return step=p10*(r<1.2?.2:r<3?.5:r<5?1:2)};fracDigits=function(step){var log10;log10=log(step)*LN_10;if(log10>=0){return 0}else{return Math.ceil(-log10)}};SVGNS=window.SVGNS;W_GRAD=Pref.W_GRADATION_DISPLAY;MARGIN=10;W_GRADFRAME=W_GRAD+2*MARGIN;W_WIND=80;W_WINDFRAME=W_WIND+2*MARGIN;Y_TEXT=7;Y_LINE=11;H_LINE=-2;Y_GRAD=Y_LINE+3;H_GRAD=8;H_GRADFRAME=Y_GRAD+H_GRAD;H_WINDFRAME=H_GRADFRAME;RE_SVGA_ALPHA=/rgba\((\d+,\s*\d+,\s*\d+),\s*(.+)\)/;ScaleDisplay=function(){function ScaleDisplay(width,height,margin,x01,x11,dxScale1){this.width=width;this.height=height;this.margin=margin;this.x0=x01;this.x1=x11;this.dxScale=dxScale1;this.svg=this.createElem("svg").attr({version:"1.1",xmlns:SVGNS,width:this.width,height:this.height});this.createScale()}ScaleDisplay.prototype.createElem=function(elem){return $(document.createElementNS(SVGNS,elem))};ScaleDisplay.prototype.getSvg=function(){return this.svg};ScaleDisplay.prototype.createScale=function(){this.gScale=this.createElem("g").attr({stroke:"rgba(0, 0, 0, 0.75)","stroke-width":1,"stroke-linecap":"square","shape-rendering":"crispEdges"}).appendTo(this.svg);return this.gText=this.createElem("g").attr({"font-family":"Arial, sans-serif","font-size":"9px","text-anchor":"middle"}).appendTo(this.svg)};ScaleDisplay.prototype.drawScale=function(){var f,gx,gxdx,results,x;this.createElem("line").attr({x1:this.margin,y1:Y_LINE,x2:this.width-this.margin,y2:Y_LINE}).appendTo(this.gScale);x=this.x0;gx=this.margin;gxdx=1*(this.width-2*this.margin)/(this.x1-this.x0);f=fracDigits(this.dxScale);results=[];while(x<=this.x1){gx=this.margin+gxdx*(x-this.x0);this.createElem("line").attr({x1:gx,y1:Y_LINE,x2:gx,y2:Y_LINE+H_LINE}).appendTo(this.gScale);this.createElem("text").attr({x:gx,y:Y_TEXT}).append(x.toFixed(f)).appendTo(this.gText);results.push(x+=this.dxScale)}return results};return ScaleDisplay}();GradientDisplay=function(superClass){extend(GradientDisplay,superClass);function GradientDisplay(x0,x1,dxScale,dxGrad,gradId,gradFunc){this.dxGrad=dxGrad;this.gradId=gradId;this.gradFunc=gradFunc;GradientDisplay.__super__.constructor.call(this,W_GRADFRAME,H_GRADFRAME,MARGIN,x0,x1,dxScale);this.createGradient();this.createDisplay();this.drawScale()}GradientDisplay.prototype.parseRGBA=function(rgba){var re;re=rgba.match(RE_SVGA_ALPHA);if(re!=null){return["rgb("+re[1]+")",re[2]]}else{return[rgba,rgba]}};GradientDisplay.prototype.createGradient=function(){var alpha,grad,ref,results,rgb,x;grad=this.createElem("linearGradient").attr({id:this.gradId}).appendTo(this.svg);x=this.x0;results=[];while(x<=this.x1){ref=this.parseRGBA(this.gradFunc(x)),rgb=ref[0],alpha=ref[1];this.createElem("stop").attr({offset:100*(x-this.x0)/(this.x1-this.x0)+"%","stop-color":rgb,"stop-opacity":alpha}).appendTo(grad);results.push(x+=this.dxGrad)}return results};GradientDisplay.prototype.createDisplay=function(){return this.createElem("rect").attr({x:this.margin,y:Y_GRAD,width:this.width-2*this.margin,height:H_GRAD,fill:"url(#"+this.gradId+")"}).appendTo(this.svg)};return GradientDisplay}(ScaleDisplay);DisplayFrame=function(){function DisplayFrame(parent1,width,height){this.parent=parent1;this.width=width;this.height=height;this.frame=$("<div id='tenkiGradation'/>").css({width:this.width+"px",height:this.height+"px"}).appendTo(this.parent)}DisplayFrame.prototype.setDisplay=function(display){this.frame.empty();if(display!=null){return this.frame.append(display.getSvg())}};return DisplayFrame}();GRADIENT=Presentation.gradient;GradationDisplay=function(){function GradationDisplay(parent,dataView){parent=$(parent);this.row=$("<div />").appendTo(parent);this.gradFrame=new DisplayFrame(this.row,W_GRADFRAME,H_GRADFRAME);this.temp=new GradientDisplay(-30,40,10,1,"SvgTempGrad",GRADIENT.temp);this.prec=new GradientDisplay(0,100,20,1,"SvgPrecGrad",GRADIENT.prec);this.sun=new GradientDisplay(0,1,.2,.1,"SvgPrecSun",GRADIENT.sun);this.fall=new GradientDisplay(0,20,5,1,"SvgPrecFall",GRADIENT.fall);this.depth=new GradientDisplay(0,300,50,1,"SvgPrecDepth",GRADIENT.depth)}GradationDisplay.prototype.setGrad=function(type){return this.gradFrame.setDisplay(function(){switch(type){case"t":return this.temp;case"p":return this.prec;case"s":return this.sun;case"f":return this.fall;case"d":return this.depth;default:return null}}.call(this))};return GradationDisplay}();window.GradationDisplay=GradationDisplay}).call(this);(function(){var DAY,HOUR,I_d_h,I_h,I_m,I_m_d,I_m_w,I_w_d,I_w_h,I_y,I_y_m,MIN,TimeScaleIterator,WEEK,W_DEFAULT,ceil,floor;ceil=Math.ceil;floor=Math.floor;MIN=Date.MIN;HOUR=Date.HOUR;DAY=Date.DAY;WEEK=Date.WEEK;W_DEFAULT=465;I_h=function(){function I_h(l1,r1,dss,ds,dt){this.l=l1;this.r=r1;this.dss=dss;this.ds=ds;this.dt=dt;this.tz=new Date(+this.l).getTimezoneOffset()*MIN;this.step=this.dss*HOUR}I_h.prototype.reset=function(){return this.setT(ceil((this.l-this.tz)/this.step)*this.step+this.tz)};I_h.prototype.next=function(){return this.setT(this.t+this.step)};I_h.prototype.setT=function(t){var d,h;this.t=t;if(this.t>this.r){return this.t=this.s=null}else{d=new Date(+this.t);h=d.hour();this.s=h===0?d.mon()+"/"+d.day():h%this.dt===0?h+":00":h%this.ds===0?"":null;return this.t}};return I_h}();I_d_h=function(){function I_d_h(l1,r1,dss){this.l=l1;this.r=r1;this.dss=dss;this.tz=new Date(+this.l).getTimezoneOffset()*MIN;this.step=this.dss*HOUR}I_d_h.prototype.reset=function(){return this.setT(ceil((this.l-this.tz)/this.step)*this.step+this.tz)};I_d_h.prototype.next=function(){return this.setT(this.t+this.step)};I_d_h.prototype.setT=function(t){var d,h;this.t=t;if(this.t>this.r){return this.t=this.s=null}else{d=new Date(+this.t);h=d.hour();this.s=h===0?d.wday()===0?d.mon()+"/"+d.day():""+d.day():null;return this.t}};return I_d_h}();I_w_h=function(){function I_w_h(l1,r1,dss){this.l=l1;this.r=r1;this.dss=dss;this.tz=new Date(+this.l).getTimezoneOffset()*MIN;this.step=this.dss*HOUR}I_w_h.prototype.reset=function(){return this.setT(ceil((this.l-this.tz)/this.step)*this.step+this.tz)};I_w_h.prototype.next=function(){return this.setT(this.t+this.step)};I_w_h.prototype.setT=function(t){var d,h;this.t=t;if(this.t>this.r){return this.t=this.s=null}else{d=new Date(+this.t);h=d.hour();this.s=h===0?d.wday()===0?d.mon()+"/"+d.day():"":null;return this.t}};return I_w_h}();I_w_d=function(){function I_w_d(l1,r1){this.l=l1;this.r=r1;this.tz=new Date(+this.l).getTimezoneOffset()*MIN}I_w_d.prototype.reset=function(){return this.setT(ceil((this.l-this.tz)/DAY)*DAY+this.tz)};I_w_d.prototype.next=function(){return this.setT(this.t+DAY)};I_w_d.prototype.setT=function(t){var d;this.t=t;if(this.t>this.r){return this.t=this.s=null}else{d=new Date(+this.t);this.s=d.wday()===0?d.mon()+"/"+d.day():null;return this.t}};return I_w_d}();I_m_d=function(){function I_m_d(l1,r1){this.l=l1;this.r=r1;this.tz=new Date(+this.l).getTimezoneOffset()*MIN}I_m_d.prototype.reset=function(){return this.setT(ceil((this.l-this.tz)/DAY)*DAY+this.tz)};I_m_d.prototype.next=function(){return this.setT(this.t+DAY)};I_m_d.prototype.setT=function(t){var d;this.t=t;if(this.t>this.r){return this.t=this.s=null}else{d=new Date(+this.t);this.s=d.day()===1?d.mon()+"/"+d.day():d.wday()===0?"":null;return this.t}};return I_m_d}();I_m_w=function(){function I_m_w(l1,r1){this.l=l1;this.r=r1;this.tz=new Date(+this.l).getTimezoneOffset()*MIN}I_m_w.prototype.reset=function(){return this.setT(ceil((this.l-this.tz)/DAY)*DAY+this.tz)};I_m_w.prototype.next=function(){return this.setT(this.t+DAY)};I_m_w.prototype.setT=function(t){var d;this.t=t;while(this.t<=this.r){d=new Date(+this.t);if(d.day()===1){this.s=d.mon()===1?""+d.year():""+d.mon();return this.t}if(d.wday()===0){this.s=null;return this.t}this.t+=DAY}return this.t=this.s=null};return I_m_w}();I_m=function(){function I_m(l1,r1,ds){this.l=l1;this.r=r1;this.ds=ds}I_m.prototype.reset=function(){var d;d=new Date(+this.l);this.d=Date.YMDH(d.year(),d.mon()+1,1,0);return this.setT(+this.d)};I_m.prototype.next=function(){return this.setT(+(this.d=this.d.nextMon()))};I_m.prototype.setT=function(t){var m;this.t=t;if(this.t>this.r){return this.t=this.s=null}else{this.s=(m=this.d.mon())===1?""+this.d.year():m%this.ds===1?""+m:null;return this.t}};return I_m}();I_y_m=function(){function I_y_m(l1,r1,dss,ds){this.l=l1;this.r=r1;this.dss=dss;this.ds=ds}I_y_m.prototype.reset=function(){var d;d=new Date(+this.l);this.d=Date.YMDH(d.year(),d.mon()+1,1,0);if(this.dss>1){while(this.d.mon()%this.dss!==1){this.d=this.d.nextMon()}}return this.setT(+this.d)};I_y_m.prototype.next=function(){return this.setT(+(this.d=this.d.nextMon(this.dss)))};I_y_m.prototype.setT=function(t){var m;this.t=t;if(this.t>this.r){return this.t=this.s=null}else{this.s=(m=this.d.mon())===1?""+this.d.year():m%this.ds===1?"":null;return this.t}};return I_y_m}();I_y=function(){function I_y(l1,r1,dss,ds,dt){this.l=l1;this.r=r1;this.dss=dss;this.ds=ds;this.dt=dt}I_y.prototype.reset=function(){var d;d=new Date(+this.l);this.d=Date.YMDH(d.year()+1,1,1,0);if(this.dss>1){while(this.d.year()%this.dss!==0){this.d=this.d.nextYear()}}return this.setT(+this.d)};I_y.prototype.next=function(){return this.setT(+(this.d=this.d.nextYear(this.dss)))};I_y.prototype.setT=function(t){var y;this.t=t;if(this.t>this.r){return this.t=this.s=null}else{y=this.d.year();this.s=y%this.dt===0?""+this.d.year():y%this.ds===0?"":null;return this.t}};return I_y}();TimeScaleIterator=function(l,r,w){w=(r-l)*W_DEFAULT/w;if(w<DAY){return new I_h(l,r,1,3,3)}else if(w<2*DAY){return new I_h(l,r,1,3,6)}else if(w<3*DAY){return new I_h(l,r,3,6,12)}else if(w<4*DAY){return new I_h(l,r,3,12,12)}else if(w<5*DAY){return new I_h(l,r,3,12,24)}else if(w<7*DAY){return new I_h(l,r,6,12,24)}else if(w<10*DAY){return new I_h(l,r,6,24,24)}else if(w<12*DAY){return new I_h(l,r,12,24,24)}else if(w<16*DAY){return new I_d_h(l,r,12)}else if(w<25*DAY){return new I_w_h(l,r,12)}else if(w<72*DAY){return new I_w_d(l,r,24)}else if(w<100*DAY){return new I_m_d(l,r)}else if(w<500*DAY){return new I_m_w(l,r)}else if(w<1200*DAY){return new I_m(l,r,3)}else if(w<1800*DAY){return new I_y_m(l,r,1,6)}else if(w<2400*DAY){return new I_y_m(l,r,3,6)}else if(w<3600*DAY){return new I_y_m(l,r,3,12)}else if(w<5e3*DAY){return new I_y_m(l,r,6,12)}else if(w<8e3*DAY){return new I_y(l,r,1,2,2)}else if(w<16e3*DAY){return new I_y(l,r,1,5,5)}else if(w<32e3*DAY){return new I_y(l,r,1,5,10)}else{return new I_y(l,r,2,10,20)}};window.TimeScaleIterator=TimeScaleIterator}).call(this);(function(){var H_DEFAULT,ValueScaleIterator,ceil;ceil=Math.ceil;H_DEFAULT=270;ValueScaleIterator=function(){function ValueScaleIterator(v0,v1,h){var d;this.v0=v0;this.v1=v1;d=(this.v1-this.v0)*H_DEFAULT/h;if(d<2){this.ds=.2;this.dss=.1;this.fs=1}else if(d<4){this.ds=.5;this.dss=.1;this.fs=1}else if(d<8){this.ds=1;this.dss=.2}else if(d<20){this.ds=2;this.dss=.5}else if(d<40){this.ds=5;this.dss=1}else if(d<80){this.ds=10;this.dss=2}else if(d<200){this.ds=20;this.dss=5}else if(d<400){this.ds=50;this.dss=10}else if(d<800){this.ds=100;this.dss=20}else{this.ds=200;this.dss=50}this.di=this.ds/this.dss}ValueScaleIterator.prototype.reset=function(){return this.set(ceil(this.v0/this.dss))};ValueScaleIterator.prototype.next=function(){return this.set(++this.i)};ValueScaleIterator.prototype.set=function(i){this.i=i;if((this.v=this.i*this.dss)<=this.v1){this.s=this.i%this.di===0?this.fs!=null?this.v.toFixed(this.fs):""+this.v:null;return this.v}else{return this.v=this.s=null}};return ValueScaleIterator}();window.ValueScaleIterator=ValueScaleIterator}).call(this);(function(){var DAY,GRAPH_SETTINGS,GRAPH_TYPES,GraphView,HOUR,H_GRAPH,H_MSG_BOX,H_VIEW,LinMap,MARGIN_B,MARGIN_L,MARGIN_R,MARGIN_T,PLACES,R_MSG_BOX,SVGNS,W_GRAPH,W_MSG_BOX,W_VIEW,XR_GRAPH,X_GRAPH,X_HELP,X_LABEL_L,X_MESSAGE,X_MSG_BOX,X_UNIT,YB_GRAPH,Y_GRAPH,Y_HELP,Y_LABEL_B,Y_MESSAGE,Y_MSG_BOX,Y_UNIT,ZOOM_MOUSE_FACTOR,ZOOM_WHEEL_FACTOR,exp,getTWMax,getTWMin,limitMinMax,timeMax,timeMin,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty,slice=[].slice;exp=Math.exp;limitMinMax=MiscUtils.limitMinMax;timeMin=DataInfo.timeMin;timeMax=DataInfo.timeMax;SVGNS=window.SVGNS;HOUR=Date.HOUR;DAY=Date.DAY;PLACES=Places;W_VIEW=Pref.W_GRAPH_VIEW;H_VIEW=Pref.H_GRAPH_VIEW;MARGIN_L=36;MARGIN_T=26;MARGIN_R=18;MARGIN_B=24;X_GRAPH=MARGIN_L;Y_GRAPH=MARGIN_T;W_GRAPH=W_VIEW-MARGIN_L-MARGIN_R;H_GRAPH=H_VIEW-MARGIN_T-MARGIN_B;XR_GRAPH=X_GRAPH+W_GRAPH;YB_GRAPH=Y_GRAPH+H_GRAPH;X_LABEL_L=X_GRAPH-4;Y_LABEL_B=Y_GRAPH+H_GRAPH+7;X_UNIT=X_LABEL_L;Y_UNIT=12;X_HELP=X_GRAPH+W_GRAPH;Y_HELP=Y_UNIT;W_MSG_BOX=220;H_MSG_BOX=50;R_MSG_BOX=4;X_MESSAGE=X_GRAPH+W_GRAPH/2;Y_MESSAGE=Y_GRAPH+H_GRAPH/2;X_MSG_BOX=X_MESSAGE-W_MSG_BOX/2;Y_MSG_BOX=Y_MESSAGE-H_MSG_BOX/2;ZOOM_MOUSE_FACTOR=.012;ZOOM_WHEEL_FACTOR=.1;GRAPH_TYPES=["t","p","w","s","f","d"];GRAPH_SETTINGS={t:{flag:4,name:"気温",unit:"(℃)",path:"graphPathT",offset:[1,2],defMax:30,margin:4},p:{flag:1,name:"降水量",unit:"(mm)",path:"graphPathP",offset:0,defMax:10},w:{flag:2,name:"風速",unit:"(m/s)",path:"graphPathW",offset:3,defMax:10},s:{flag:8,name:"日照時間",unit:"(時)",path:"graphPathS",offset:5,defMax:1.1},f:{flag:16,name:"降雪量",unit:"(cm)",path:"graphPathF",offset:6,defMax:10},d:{flag:16,name:"積雪量",unit:"(cm)",path:"graphPathD",offset:7,defMax:40}};getTWMin=function(){return HOUR*12};getTWMax=function(){return(timeMax()-timeMin())*1.2};LinMap=MiscUtils.LinMap;GraphView=function(superClass){extend(GraphView,superClass);function GraphView(infoView){var gm,help,marker,msgBox,msgText,pane,rect,svg,unit,x;this.infoView=infoView;GraphView.__super__.constructor.call(this,"div");this.weatherCtl=this.infoView.weatherCtl;this.trendCtl=new TrendController(this);this.type="t";this.appendChild(this.svg=svg=document.createElementNS(SVGNS,"svg"));svg.setAttribute("class","graph");svg.setAttribute("version","1.1");svg.setAttribute("xmlns",SVGNS);svg.setAttribute("width",""+W_VIEW);svg.setAttribute("height",""+H_VIEW);svg.appendChild(this.unit=unit=document.createElementNS(SVGNS,"text"));unit.setAttribute("class","graphLabelL");unit.setAttribute("x",""+X_UNIT);unit.setAttribute("y",""+Y_UNIT);unit.appendChild(document.createTextNode(GRAPH_SETTINGS[this.type].name));svg.appendChild(help=document.createElementNS(SVGNS,"text"));help.setAttribute("class","graphLabelL");help.setAttribute("x",""+X_HELP);help.setAttribute("y",""+Y_HELP);help.appendChild(document.createTextNode("横ドラッグ: 時間移動       縦ドラッグ/ホイール: ズーム  "));svg.appendChild(this.rect=rect=document.createElementNS(SVGNS,"rect"));rect.setAttribute("class","graphBG");rect.setAttribute("x",""+X_GRAPH);rect.setAttribute("y",""+Y_GRAPH);rect.setAttribute("width",""+W_GRAPH);rect.setAttribute("height",""+H_GRAPH);svg.appendChild(this.gp=document.createElementNS(SVGNS,"g"));svg.appendChild(this.gs=document.createElementNS(SVGNS,"g"));svg.appendChild(this.marker=marker=document.createElementNS(SVGNS,"line"));x=""+(X_GRAPH+W_GRAPH/2);marker.setAttribute("class","graphMarker");marker.setAttribute("x1",x);marker.setAttribute("x2",x);marker.setAttribute("y1",""+Y_GRAPH);marker.setAttribute("y2",""+YB_GRAPH);svg.appendChild(pane=document.createElementNS(SVGNS,"rect"));pane.setAttribute("class","graphMousePane");pane.setAttribute("x",""+X_GRAPH);pane.setAttribute("y",""+Y_GRAPH);pane.setAttribute("width",""+W_GRAPH);pane.setAttribute("height",""+H_GRAPH);pane=jQuery(pane);pane.mousedown(function(_this){return function(event){return _this.mousedown(event)}}(this));pane.mousemove(function(_this){return function(event){return _this.mousemove(event)}}(this));pane.mouseup(function(_this){return function(event){return _this.mouseup(event)}}(this));pane.mouseout(function(_this){return function(event){return _this.mouseup(event)}}(this));pane.mousewheel(function(_this){return function(event){return _this.mousewheel(event)}}(this));this.gm=gm=document.createElementNS(SVGNS,"g");gm.appendChild(msgBox=document.createElementNS(SVGNS,"rect"));msgBox.setAttribute("class","graphMsgBox");msgBox.setAttribute("x",""+X_MSG_BOX);msgBox.setAttribute("y",""+Y_MSG_BOX);msgBox.setAttribute("width",""+W_MSG_BOX);msgBox.setAttribute("height",""+H_MSG_BOX);msgBox.setAttribute("rx",""+R_MSG_BOX);msgBox.setAttribute("ry",""+R_MSG_BOX);gm.appendChild(this.msgText=msgText=document.createElementNS(SVGNS,"text"));msgText.setAttribute("class","graphMsgText");msgText.setAttribute("x",""+X_MESSAGE);msgText.setAttribute("y",""+Y_MESSAGE);return}GraphView.prototype.initTimeView=function(){var t;if(this.tL==null){if((t=this.weatherCtl.getTime())!=null){t=+t.floorDay();this.tL=t;this.tR=t+Date.DAY}}return this.tL};GraphView.prototype.onSetPlace=function(){if(this.initTimeView()!=null){this.trendCtl.requestData(this.infoView.id,this.tL,this.tR,W_GRAPH)}};GraphView.prototype.onAttach=function(attached){var dt,t;if((this.attached=attached?true:null)!=null){if(this.tL!=null&&this.tR!=null){t=+this.weatherCtl.getTime();if(!(this.tL<=t&&t<=this.tR)){dt=(this.tR-this.tL)/2;this.tL=t-dt;this.tR=t+dt}}this.onSetPlace()}};GraphView.prototype.update=function(sender,success){var dt,iter,t;if(success){if(sender===this.trendCtl){iter=this.trendCtl.iterator;this.tL=+iter.tL;this.tR=+iter.tR;this.renderGraph(iter)}else{this.initTimeView();t=+this.weatherCtl.getTime();if(this.tL<=t&&t<=this.tR){this.updateMarker()}else{dt=(this.tR-this.tL)/2;this.trendCtl.requestData(this.infoView.id,t-dt,t+dt,W_GRAPH)}}}};GraphView.prototype.renderGraph=function(iter){this.removeChildren(this.gp,this.gs);this.renderHScale(iter);if(this.type==="t"){this.renderTemp(iter)}else{this.renderValue(this.type,iter)}this.updateMarker();this.updateMessage(iter)};GraphView.prototype.renderTemp=function(iter){var a,b,d,dt,klass,l,max,min,minMax,p,path,q,setting,t,x,x0,xmap,y,ymap;setting=GRAPH_SETTINGS.t;klass=setting.path;if((minMax=this.findTMinMax(iter))!=null){this.showMessage(null);min=minMax[0]-setting.margin;max=minMax[1]+setting.margin;this.renderVScale(min,max);xmap=new LinMap(iter.tL,iter.tR,X_GRAPH,XR_GRAPH);a=xmap.a;b=xmap.b;ymap=new LinMap(min,max,YB_GRAPH,Y_GRAPH);p=ymap.a;q=ymap.b;t=iter.reset();dt=iter.dt;path=null;while(t!=null){if((d=iter.x)!=null&&(l=d[1])!=null){x=(x=a*t+b)>XR_GRAPH?""+XR_GRAPH:(""+x).slice(0,6);y=(""+(p*d[2]+q)).slice(0,6);path=path!=null?"H"+x+"V"+(""+(p*l+q)).slice(0,6)+path+("V"+y+"H"+x):((x0=a*(t-dt)+b)<X_GRAPH?x0=X_GRAPH:void 0,"H"+x+"V"+(""+(p*l+q)).slice(0,6)+("H"+x0+"V"+y+"H"+x))}else if(path!=null){this.addPath("M"+x+","+y+path+"Z",klass);path=null}t=iter.next()}if(path!=null){this.addPath("M"+x+","+y+path+"Z",klass)}}else{this.renderVScale(0,setting.defMax)}};GraphView.prototype.renderValue=function(type,iter){var a,b,d,dt,i,klass,max,minw,p,path,q,setting,t,v,x,x0,xmap,y0,ymap;setting=GRAPH_SETTINGS[type];i=setting.offset;minw=setting.defMax;klass=setting.path;if((max=this.findMax(iter,i))!=null){if((max*=1.05)<minw){max=minw}this.renderVScale(0,max);xmap=new LinMap(iter.tL,iter.tR,X_GRAPH,X_GRAPH+W_GRAPH);a=xmap.a;b=xmap.b;ymap=new LinMap(0,max,Y_GRAPH+H_GRAPH,Y_GRAPH);p=ymap.a;q=ymap.b;t=iter.reset();dt=iter.dt;y0=""+YB_GRAPH;path=null;while(t!=null){if((d=iter.x)!=null&&(v=d[i])!=null){if(path==null){if((x0=a*(t-dt)+b)<X_GRAPH){x0=X_GRAPH}path="M"+(""+x0).slice(0,6)+(","+y0)}if((x=a*t+b)>XR_GRAPH){x=XR_GRAPH}path+="V"+(""+(p*v+q)).slice(0,6)+"H"+(""+x).slice(0,6)}else if(path!=null){this.addPath(path+"V"+y0+"Z",klass);path=null}t=iter.next()}if(path!=null){this.addPath(path+"V"+y0+"Z",klass)}}else{this.renderVScale(0,minw)}};GraphView.prototype.renderHScale=function(iter){var a,b,l,map,s,sc,t,tL,tR,x,y1,y2,ys;tL=+iter.tL;tR=+iter.tR;sc=TimeScaleIterator(iter.tL,iter.tR,W_GRAPH);t=sc.reset();map=new LinMap(tL,tR,X_GRAPH,X_GRAPH+W_GRAPH);a=map.a;b=map.b;y1=""+Y_GRAPH;y2=""+YB_GRAPH;ys=""+Y_LABEL_B;while(t!=null){this.gs.appendChild(s=document.createElementNS(SVGNS,"line"));s.setAttribute("class",sc.s!=null?"graphScale":"graphSubscale");x=(""+(a*t+b)).slice(0,6);s.setAttribute("x1",x);s.setAttribute("x2",x);s.setAttribute("y1",y1);s.setAttribute("y2",y2);if(sc.s!=null&&sc.s.length>0){this.gs.appendChild(l=document.createElementNS(SVGNS,"text"));l.setAttribute("class","graphLabelB");l.setAttribute("x",x);l.setAttribute("y",ys);l.appendChild(document.createTextNode(sc.s))}t=sc.next()}};GraphView.prototype.renderVScale=function(min,max){var a,b,l,map,s,sc,v,x1,x2,xs,y;x1=""+X_GRAPH;xs=""+X_LABEL_L;x2=""+XR_GRAPH;map=new LinMap(min,max,Y_GRAPH+H_GRAPH,Y_GRAPH);a=map.a;b=map.b;sc=new ValueScaleIterator(min,max,H_GRAPH);v=sc.reset();while(v!=null){this.gs.appendChild(s=document.createElementNS(SVGNS,"line"));s.setAttribute("class",sc.s!=null?"graphScale":"graphSubscale");y=(""+(a*v+b)).slice(0,6);s.setAttribute("x1",x1);s.setAttribute("x2",x2);s.setAttribute("y1",y);s.setAttribute("y2",y);if(sc.s!=null){this.gs.appendChild(l=document.createElementNS(SVGNS,"text"));l.setAttribute("class","graphLabelL");l.setAttribute("x",xs);l.setAttribute("y",y);l.appendChild(document.createTextNode(sc.s))}v=sc.next()}};GraphView.prototype.updateMarker=function(){var marker,t,x;t=+this.weatherCtl.getTime();marker=this.marker;if(this.tL<=t&&t<=this.tR){x=(""+(X_GRAPH+W_GRAPH*(t-this.tL)/(this.tR-this.tL))).slice(0,6);marker.setAttribute("x1",x);marker.setAttribute("x2",x);marker.setAttribute("class","graphMarker")}else{marker.setAttribute("class","graphHidden")}};GraphView.prototype.updateMessage=function(iter){var place,setting;place=PLACES[iter.id];setting=GRAPH_SETTINGS[this.type];if((place.flags&setting.flag)!==0){this.showMessage(null)}else{this.showMessage(setting.name+"のデータはありません")}};GraphView.prototype.setTimeView=function(tL,tR){var t,tm,wt;if(tL<tR){wt=limitMinMax(tR-tL,getTWMin(),getTWMax());tm=wt/2;if(tL<(t=+timeMin()-tm)){tL=t;tR=tL+wt}else if(tR>(t=+timeMax()+tm)){tR=t;tL=tR-wt}if(this.attached!=null){this.trendCtl.requestData(this.infoView.id,tL,tR,W_GRAPH)}}};GraphView.prototype.mousedown=function(event){var r;event.preventDefault();if(this.tL!=null&&this.tR!=null){this.shift=event.shiftKey;this.ctrl=event.ctrlKey;r=this.rect.getBoundingClientRect();this.x=event.clientX-r.left;this.y=event.clientY-r.top;this.w=this.tR-this.tL;this.t=typeof shift!=="undefined"&&shift!==null?this.t=this.tL+this.x*this.w/W_GRAPH:this.t=this.tL+this.x*this.w/W_GRAPH;if(!(this.shift||this.ctrl)){this.weatherCtl.setTime(this.t)}}};GraphView.prototype.mousemove=function(event){var r,twMax,twMin,w,x,y;event.preventDefault();if(this.x!=null){r=this.rect.getBoundingClientRect();x=this.ctrl?this.x:event.clientX-r.left;y=event.clientY-r.top;w=this.shift?this.w:this.w*exp(ZOOM_MOUSE_FACTOR*(y-this.y));if(w<(twMin=getTWMin())){w=twMin}else if(w>(twMax=getTWMax())){w=twMax}this.setTimeView(this.t-w*x/W_GRAPH,this.t+w*(W_GRAPH-x)/W_GRAPH)}};GraphView.prototype.mouseup=function(event){this.x=this.y=this.w=this.t=null};GraphView.prototype.mousewheel=function(event){var l,r,scale,t,twMax,twMin,x;event.preventDefault();if(this.tL!=null&&this.tR!=null){x=event.clientX-this.rect.getBoundingClientRect().left;t=this.tL+(this.tR-this.tL)*x/W_GRAPH;scale=exp(-ZOOM_WHEEL_FACTOR*event.deltaY);l=t-(t-this.tL)*scale;r=t+(this.tR-t)*scale;if(r-l<(twMin=getTWMin())){l=t-twMin*(t-this.tL)/(this.tR-this.tL);r=l+twMin}else if(r-l>(twMax=getTWMax())){l=t-twMax*(t-this.tL)/(this.tR-this.tL);r=l+twMax}this.setTimeView(l,r)}};GraphView.prototype.findMax=function(iter,i){var max,t,x,y;t=iter.reset();max=null;while(t!=null){if((x=iter.x)!=null&&(y=x[i])!=null){max=y;break}t=iter.next()}if(max!=null){while(iter.next()!=null){if((x=iter.x)!=null&&(y=x[i])!=null&&y>max){max=y}}}return max};GraphView.prototype.findTMinMax=function(iter){var max,min,t,x,y;t=iter.reset();min=max=null;while(t!=null){if((x=iter.x)!=null&&(y=x[1])!=null){min=y;max=x[2];break}t=iter.next()}if(min!=null){while(iter.next()!=null){if((x=iter.x)!=null&&(y=x[1])!=null){if(y<min){min=y}if((y=x[2])>max){max=y}}}return[min,max]}};GraphView.prototype.addPath=function(path,klass){var p;this.gp.appendChild(p=document.createElementNS(SVGNS,"path"));p.setAttribute("class",klass);p.setAttribute("d",path)};GraphView.prototype.setGraph=function(type){if(GRAPH_TYPES.indexOf(type)!==-1){this.type=type;this.removeChildren(this.unit);this.unit.appendChild(document.createTextNode(GRAPH_SETTINGS[this.type].unit));if(this.trendCtl.iterator!=null){this.update(this.trendCtl,true)}}};GraphView.prototype.showMessage=function(msg){if(msg!=null){if(this.gm.parentNode==null){this.svg.appendChild(this.gm)}this.removeChildren(this.msgText);this.msgText.appendChild(document.createTextNode(msg))}else{if(this.gm.parentNode!=null){this.svg.removeChild(this.gm)}}};GraphView.prototype.removeChildren=function(){var e,elems,j,len;elems=1<=arguments.length?slice.call(arguments,0):[];for(j=0,len=elems.length;j<len;j++){e=elems[j];MiscUtils.removeChildren(e)}};return GraphView}(GoogleMapsWidget.Element);window.GraphView=GraphView}).call(this);(function(){var DIR,DataView,HEADERS,HOUR,NULL,TDData,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;HOUR=Date.HOUR;HEADERS=["時刻<br />(時)","気温<br />(℃)","降水量<br />(mm)","風速<br />(m/s)","風向","日照時間<br />(時)","降雪量<br />(cm)","積雪量<br />(cm)"];DIR=DataInfo.WIND_DIRECTION;NULL="---";TDData=function(superClass){extend(TDData,superClass);function TDData(tr,align,view,hour1){this.view=view;this.hour=hour1;TDData.__super__.constructor.call(this,tr,NULL,align);this.bind("mousedown",function(_this){return function(event){return _this.mousedown(event)}}(this))}TDData.prototype.mousedown=function(event){return this.view.clickOnTable(this.hour)};return TDData}(GoogleMapsWidget.TD);DataView=function(superClass){extend(DataView,superClass);function DataView(infoView){var hdr,i,j,len,tr;this.infoView=infoView;DataView.__super__.constructor.call(this,null);this.weatherCtl=this.infoView.weatherCtl;this.trendCtl=new TrendController(this);tr=this.addTR();for(j=0,len=HEADERS.length;j<len;j++){hdr=HEADERS[j];tr.addTH(hdr)}this.items=function(){var k,results;results=[];for(i=k=0;k<24;i=++k){tr=this.addTR();results.push([new TDData(tr,"right",this,i),new TDData(tr,"right",this,i),new TDData(tr,"right",this,i),new TDData(tr,"right",this,i),new TDData(tr,"center",this,i),new TDData(tr,"right",this,i),new TDData(tr,"right",this,i),new TDData(tr,"right",this,i)])}return results}.call(this);this.id=this.t0=this.now=null}DataView.prototype.onSetPlace=function(){var t;if((t=this.weatherCtl.getTime())!=null){t=t.floorDay();this.trendCtl.requestData(this.infoView.id,t,t.nextHour(23),24)}};DataView.prototype.onAttach=function(toAttach){if(toAttach){this.onSetPlace()}};DataView.prototype.update=function(sender,success){var iter;if(success){if(sender===this.weatherCtl){this.updateTime(this.weatherCtl.getTime())}else{if((iter=sender.iterator)!=null&&iter.hasData!=null){this.updateTable(iter)}else{this.clearTable()}}}};DataView.prototype.updateTime=function(t){t=t.floorDay();if(this.t0!=null&&this.t0.sameDay(t)&&this.id!=null&&this.id===this.infoView.id){this.updateNow()}else{this.trendCtl.requestData(this.infoView.id,t,t.nextHour(23),24)}};DataView.prototype.updateTable=function(iter){var depth,dir,fall,h,hours,j,k,l,len,len1,len2,m,prec,ref,ref1,results,sun,t,t0,td,temp,vel,x;t=iter.reset();t0=new Date(t).floorHour();if(this.id!==iter.id||this.t0==null||!this.t0.sameDay(t0)){this.id=iter.id;this.t0=t0;hours=function(){results=[];for(j=0;j<=23;j++){results.push(j)}return results}.apply(this);while(t!=null){x=iter.x;h=(t-t0)/HOUR;if((td=this.items[h])!=null){if(x!=null){hours.splice(hours.indexOf(h),1);prec=x[0];temp=x[1];vel=x[3];dir=x[4];sun=x[5];fall=x[6];depth=x[7];td[0].setText(""+h);td[1].setText(temp!=null?temp.toFixed(1):NULL);td[2].setText(prec!=null?prec.toFixed(1):NULL);td[3].setText(vel!=null?vel.toFixed(1):NULL);td[4].setText(dir!=null?DIR[dir]:NULL);td[5].setText(sun!=null?sun.toFixed(1):NULL);td[6].setText(fall!=null?""+fall:NULL);td[7].setText(depth!=null?""+depth:NULL)}else{ref=this.items[h];for(k=0,len=ref.length;k<len;k++){td=ref[k];td.setText(NULL)}}}t=iter.next()}for(l=0,len1=hours.length;l<len1;l++){h=hours[l];ref1=this.items[h];for(m=0,len2=ref1.length;m<len2;m++){td=ref1[m];td.setText(NULL)}}}this.updateNow()};DataView.prototype.updateNow=function(){var now;if(this.now!=null){this.setHighlight(this.now.hour(),false)}this.now=null;now=this.weatherCtl.getTime();if(this.t0!=null&&this.t0.sameDay(now)){this.setHighlight(now.hour(),true);this.now=now}};DataView.prototype.setHighlight=function(hour,hi){var item,j,len,ref;hi=hi?"highlight":"regular";ref=this.items[hour];for(j=0,len=ref.length;j<len;j++){item=ref[j];item.setHighlight(hi)}};DataView.prototype.clearTable=function(){var j,k,len,len1,ref,td,tr;ref=this.items;for(j=0,len=ref.length;j<len;j++){tr=ref[j];for(k=0,len1=tr.length;k<len1;k++){td=tr[k];td.setText(NULL)}}};DataView.prototype.clickOnTable=function(hour){var t;if(!this.t0){return}t=this.t0.nextHour(hour);if(DataInfo.timeMin()<=t&&t<=DataInfo.timeMax()){this.weatherCtl.setTime(t)}};return DataView}(GoogleMapsWidget.Table);window.DataView=DataView}).call(this);(function(){var LAT_PREFIX,LON_PREFIX,NULL,PLACES,PlaceInfoView,RE_NAME,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;PLACES=Places;NULL="---";RE_NAME=/^(.+) - (.+)$/;LAT_PREFIX=["北緯","南緯"];LON_PREFIX=["東経","西経"];PlaceInfoView=function(superClass){extend(PlaceInfoView,superClass);function PlaceInfoView(infoView){var tr;this.infoView=infoView;PlaceInfoView.__super__.constructor.call(this,null);tr=this.addTR();tr.addTH("地域");this.pref=tr.addTDL(NULL);tr=this.addTR();tr.addTH("地名");this.name=tr.addTDL(NULL);tr=this.addTR();tr.addTH("緯度");this.lat=tr.addTDL(NULL);tr=this.addTR();tr.addTH("経度");this.lon=tr.addTDL(NULL);tr=this.addTR();tr.addTH("標高");this.alt=tr.addTDL(NULL);tr=this.addTR();tr.addTH("観測量");this.obs=tr.addTDL(NULL)}PlaceInfoView.prototype.refresh=function(){var id,p,re,x,y;id=this.infoView.id;if((p=PLACES[id])!=null){re=p.name.match(RE_NAME);this.pref.setText(re[1]);this.name.setText(re[2]);x=this.numberToDegMinSec(p.lat);y=this.numberToDegMinSec(p.lon);this.lat.setText(""+LAT_PREFIX[x[0]]+x[1]+"度"+x[2]+"分"+x[3]+"秒");this.lon.setText(""+LON_PREFIX[y[0]]+y[1]+"度"+y[2]+"分"+y[3]+"秒");this.alt.setText(p.alt.toFixed(id>=1e4?1:0)+"m");this.obs.setText(this.observingValues(p.flags))}else{this.pref.setText(NULL);this.name.setText(NULL);this.lat.setText(NULL);this.lon.setText(NULL);this.alt.setText(NULL);this.obs.setText(NULL)}};PlaceInfoView.prototype.numberToDegMinSec=function(x){var s;s=Math.round(3600*Math.abs(x));return[Number(x<0),s/3600>>0,(s/60>>0)%60,s%60]};PlaceInfoView.prototype.observingValues=function(flags){var s;s=[];if((flags&4)!==0){s.push("気温")}if((flags&1)!==0){s.push("降水量")}if((flags&2)!==0){s.push("風速・風向")}if((flags&8)!==0){s.push("日照時間")}if((flags&16)!==0){s.push("降雪・積雪")}return s.join(", ")};PlaceInfoView.prototype.onAttach=function(attached){if(attached){return this.refresh()}};PlaceInfoView.prototype.update=function(sender,success){if(success){return this.refresh()}};PlaceInfoView.prototype.onSetPlace=function(){return this.refresh()};return PlaceInfoView}(GoogleMapsWidget.Table);window.PlaceInfoView=PlaceInfoView}).call(this);(function(){var InfoView,PLACES,RE_OPT_I,RE_OPT_P,RE_OPT_R,RE_OPT_V,VIEW_TYPES,WDAY;PLACES=Places;WDAY=["日","月","火","水","木","金","土"];VIEW_TYPES=["t","p","w","s","f","d","l","i"];RE_OPT_V=/^([01])$/;RE_OPT_P=/^(\d+)$/;RE_OPT_I=/^([tpwsfdli])$/;RE_OPT_R=/^(\d{4})(\d\d)(\d\d)(\d\d)(\d\d),(\d{4})(\d\d)(\d\d)(\d\d)(\d\d)$/;InfoView=function(){function InfoView(frame,weatherView){var divR,row;this.frame=frame;this.weatherView=weatherView;this.weatherCtl=this.weatherView.ctl;this.weatherCtl.addView(this);this.view=this.frame.addSubframe();this.frame.removeChild(this.view);this.attached=false;this.view.addHR();row=this.view.addRow();row.getElement().style.height="18px";this.name=row.addStatic("---");divR=document.createElement("div");divR.className="topRight";row.appendChild(divR);new GoogleMapsWidget.Button(divR,"&nbsp;閉じる&nbsp;","情報ビューを閉じる",function(_this){return function(){return _this.attach(false)}}(this));row=this.view.addRow();this.radT=row.addRadioGroup(function(_this){return function(i){return _this.setViewType(VIEW_TYPES[i])}}(this));this.radT.add("気温","気温トレンドグラフを表示");this.radT.add("降水","降水量トレンドグラフを表示");this.radT.add("風速","風速トレンドグラフを表示");this.radT.add("日照","日照時間トレンドグラフを表示");this.radT.add("降雪","降雪量トレンドグラフを表示");this.radT.add("積雪","積雪量トレンドグラフを表示");this.radT.add("データ","一日分の全データを表示");this.radT.add("地点情報","地点情報を表示");this.radT.finalize(0);this.contentsFrame=this.view.addRow();this.contents=this.graph=new GraphView(this);this.data=new DataView(this);this.placeInfo=new PlaceInfoView(this);this.type="t";this.contentsFrame.appendChild(this.graph);this.graph.onAttach(true)}InfoView.prototype.processOption=function(option){var attached,id,l,r,re,type;attached=type=l=r=null;if(option.v!=null&&(re=option.v.match(RE_OPT_V))){attached=re[1]==="1"}if(option.p!=null&&(re=option.p.match(RE_OPT_P))){if(PLACES[id=parseInt(re[1])]!=null){this.id=id}}if(option.i!=null&&(re=option.i.match(RE_OPT_I))){type=re[1]}if(option.r!=null&&(re=option.r.match(RE_OPT_R))){l=Date.YMDHM(parseInt(re[1]),parseInt(re[2]),parseInt(re[3]),parseInt(re[4]),parseInt(re[5]));r=Date.YMDHM(parseInt(re[6]),parseInt(re[7]),parseInt(re[8]),parseInt(re[9]),parseInt(re[10]))}if(attached!=null){this.attach(attached)}if(this.id!=null&&this.attached){this.weatherView.showMarker(this.id);this.showPlace(this.id)}if(l!=null&&r!=null){this.graph.setTimeView(l,r)}if(type!=null){this.setViewType(type)}};InfoView.prototype.attach=function(attached){if(attached){if(!this.attached){this.frame.appendChild(this.view)}}else{if(this.attached){this.frame.removeChild(this.view)}this.weatherView.showMarker(null)}return this.attached=attached};InfoView.prototype.showPlace=function(id1){this.id=id1;this.attach(true);this.updateTitle();return this.contents.onSetPlace()};InfoView.prototype.update=function(sender,success){if(!(this.attached&&success)){return}this.updateTitle();return this.contents.update(sender,success)};InfoView.prototype.setViewType=function(type1){var nextContents;this.type=type1;this.radT.select(VIEW_TYPES.indexOf(this.type));nextContents=function(){switch(this.type){case"l":return this.data;case"i":return this.placeInfo;default:this.graph.setGraph(this.type);return this.graph}}.call(this);if(this.contents===nextContents){return}this.contents.onAttach(false);this.contentsFrame.replaceChild(nextContents,this.contents);this.contents=nextContents;this.contents.onAttach(true)};InfoView.prototype.updateTitle=function(){var p,t,title;title=(t=this.weatherCtl.getTime())!=null?t.year()+"年"+t.mon()+"月"+t.day()+"日 ("+WDAY[t.wday()]+") "+t.hour()+"時":"----年--月--日 --時";title+=" &nbsp; ";p=PLACES[this.id];title+=p!=null?p.name:"---";this.name.setText(title)};InfoView.prototype.sNN=function(n){if(n<10){return"0"+n}else{return""+n}};InfoView.prototype.getTimeQuery=function(t){t=new Date(t);return""+t.year()+this.sNN(t.mon())+this.sNN(t.day())+this.sNN(t.hour())+this.sNN(t.min())};InfoView.prototype.getQuery=function(){var l,q,r;q="v="+(this.attached?"1":"0");if(this.id!=null){q+="&p="+this.id}if(this.type!=null){q+="&i="+this.type}l=this.graph.tL;r=this.graph.tR;if(l!=null&&r!=null){q+="&r="+this.getTimeQuery(l)+","+this.getTimeQuery(r)}return q};return InfoView}();window.InfoView=InfoView}).call(this);(function(){var ARROW_L,ARROW_R,CIRCLE_TYPE,IS_PC,ITEMS_CIRCLE,ITEMS_SIZE,ITEMS_SPEED,RE_OPTION_D,WeatherControlView,addSelectItems,isChrome,updateSelectRange;RE_OPTION_D=/^(\d{4})(\d\d)(\d\d)(\d\d)(\d\d)$/;CIRCLE_TYPE=["t","p","s","f","d"];ITEMS_SPEED=[["遅い",0],["通常",1],["速い",2],["最速",3]];ITEMS_CIRCLE=[["気温","t"],["降水","p"],["日照","s"],["降雪","f"],["積雪","d"]];ITEMS_SIZE=[["なし",0],["小",1],["中",2],["大",3]];isChrome=navigator.userAgent.indexOf("Chrome")!==-1;ARROW_L=isChrome?"◀":"◂";ARROW_R=isChrome?"▶":"▸";IS_PC=Pref.platform==="pc";addSelectItems=function(sel,items){var item,j,len,results;results=[];for(j=0,len=items.length;j<len;j++){item=items[j];results.push(sel.add(item[0],item[1]))}return results};updateSelectRange=function(sel,min,max){var j,len,opt,ref,ref1,results;ref=sel.options();results=[];for(j=0,len=ref.length;j<len;j++){opt=ref[j];results.push(opt.disabled=!(min<=(ref1=parseInt(opt.value))&&ref1<=max))}return results};WeatherControlView=function(){function WeatherControlView(weatherView){var frame,googleControls;this.weatherView=weatherView;this.ctl=this.weatherView.ctl;this.frame=new GoogleMapsWidget.Frame;this.createDateTimeControls();this.createOptionControls();this.createDisplay();this.infoView=new InfoView(this.frame,this.weatherView);frame=this.frame.getElement();frame.index=1;googleControls=this.weatherView.getMap().controls;googleControls[google.maps.ControlPosition.TOP_CENTER].push(frame)}WeatherControlView.prototype.createDateTimeControls=function(){var d,h,j,k,l,m,row;row=this.frame.addRow();if(IS_PC){this.prevY=row.addButton(ARROW_L,"1年前",function(_this){return function(){return _this.buttonPrevY()}}(this))}this.selY=row.addSelect(function(_this){return function(){return _this.selectDate()}}(this));this.selY.setTitle("年の設定");this.updateSelY();if(IS_PC){this.nextY=row.addButton(ARROW_R,"1年後",function(_this){return function(){return _this.buttonNextY()}}(this))}row.addText("年");row.addSpacer(2);if(IS_PC){this.prevM=row.addButton(ARROW_L,"1ヶ月前",function(_this){return function(){return _this.buttonPrevM()}}(this))}this.selM=row.addSelect(function(_this){return function(){return _this.selectDate()}}(this));this.selM.setTitle("月の設定");for(m=j=1;j<=12;m=++j){this.selM.add(""+m,""+m)}if(IS_PC){this.nextM=row.addButton(ARROW_R,"1ヶ月後",function(_this){return function(){return _this.buttonNextM()}}(this))}row.addText("月");row.addSpacer(2);this.prevD=row.addButton(ARROW_L,"1日前",function(_this){return function(){return _this.buttonPrevD()}}(this));this.selD=row.addSelect(function(_this){return function(){return _this.selectDate()}}(this));this.selD.setTitle("日の設定");for(d=k=1;k<=31;d=++k){this.selD.add(""+d,""+d)}this.nextD=row.addButton(ARROW_R,"1日後",function(_this){return function(){return _this.buttonNextD()}}(this));row.addText("日");row.addSpacer(2);this.prevH=row.addButton(ARROW_L,"1時間前",function(_this){return function(){return _this.buttonPrevH()}}(this));this.selH=row.addSelect(function(_this){return function(){return _this.selectDate()}}(this));this.selH.setTitle("時の設定");for(h=l=0;l<=23;h=++l){this.selH.add(""+h,""+h)}this.nextH=row.addButton(ARROW_R,"1時間後",function(_this){return function(){return _this.buttonNextH()}}(this));return row.addText("時")};WeatherControlView.prototype.createOptionControls=function(){var row;row=this.frame.addRow();this.play=row.addButton("&nbsp;再生&nbsp;","再生/停止",function(_this){return function(){return _this.buttonPlay()}}(this));this.selA=row.addSelect(function(_this){return function(){return _this.selectA()}}(this));this.selA.setTitle("再生速度");addSelectItems(this.selA,ITEMS_SPEED);row.addSpacer(2);if(IS_PC){this.radC=row.addRadioGroup(function(_this){return function(i){return _this.radioC(i)}}(this));this.radC.add("気温","気温を表示");this.radC.add("降水","降水量を表示");this.radC.add("日照","日照時間を表示");this.radC.add("降雪","降雪量を表示");this.radC.add("積雪","積雪量を表示");this.radC.finalize()}else{this.selC=row.addSelect(function(_this){return function(){return _this.selectC()}}(this));this.selC.setTitle("円の表示タイプ");addSelectItems(this.selC,ITEMS_CIRCLE)}row.addSpacer(1);this.selS=row.addSelect(function(_this){return function(){return _this.selectS()}}(this));this.selS.setTitle("円のサイズ");addSelectItems(this.selS,ITEMS_SIZE);row.addSpacer(2);row.addText("風速");row.addSpacer(1);this.selW=row.addSelect(function(_this){return function(){return _this.selectW()}}(this));this.selW.setTitle("風速・風向の表示サイズ");addSelectItems(this.selW,ITEMS_SIZE);row.addSpacer(2);return row.addButton("&nbsp;保存&nbsp;","状態をブラウザ履歴に保存",function(_this){return function(){return _this.saveURL()}}(this))};WeatherControlView.prototype.createDisplay=function(){var link,row,rowElem;row=this.frame.addRow();rowElem=row.getElement();rowElem.css;$(rowElem).css({width:"100%",height:"25px"});link=IS_PC?"<a href='index_m.html'class='noDeco'>モバイル版</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;":"<a href='index_p.html'class='noDeco'>PC版&nbsp;&nbsp;&nbsp;&nbsp;</a>";this.disp=new GradationDisplay(rowElem,this.weatherView);return $(rowElem).append($("<div id='tenkiLinks'><br />"+link+"<a href='https://github.com/higuma/tenki-data-map' class='noDeco'>天気データマップについて...</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>"))};WeatherControlView.prototype.parseOption=function(opt,option){var d,key,re,ref,v,value;this.option=option;for(key in opt){value=opt[key];switch(key){case"c":switch(value){case"t":case"p":case"s":case"f":case"d":this.option[key]=value}break;case"s":case"w":case"a":if(0<=(ref=v=parseInt(value))&&ref<=3){this.option[key]=v}break;case"d":if((re=value.match(RE_OPTION_D))!=null){d=Date.YMDHM(parseInt(re[1]),parseInt(re[2]),parseInt(re[3]),parseInt(re[4]),parseInt(re[5]));d=d.ceilHour();if(DataInfo.timeMin()<=d&&d<=DataInfo.timeMax()){this.option.d=d}}break;default:this.option[key]=value}}};WeatherControlView.prototype.processOption=function(opt,option){this.option=option;this.parseOption(opt,this.option);this.selA.select(this.option.a);if(IS_PC){this.radC.select(CIRCLE_TYPE.indexOf(this.option.c))}else{this.selC.select(this.option.c)}this.selS.select(this.option.s);this.selW.select(this.option.w);this.disp.setGrad(this.option.c);this.infoView.processOption(this.option)};WeatherControlView.prototype.sNN=function(n){if(n<10){return"0"+n}else{return""+n}};WeatherControlView.prototype.dateQueryString=function(){var d;d=this.ctl.getTime();return""+d.year()+this.sNN(d.mon())+this.sNN(d.day())+this.sNN(d.hour())+this.sNN(d.min())};WeatherControlView.prototype.updateSelY=function(){var j,options,ref,ref1,y,y0,y1,yMax,yMin;yMin=DataInfo.timeMin().year();yMax=DataInfo.timeMax().year();options=this.selY.options();if(options.length>0){y0=parseInt(options[0].value);y1=parseInt(options[options.length-1].value);if(y0===yMin&&y1===yMax){return}}this.selY.clear();for(y=j=ref=yMin,ref1=yMax;ref<=ref1?j<=ref1:j>=ref1;y=ref<=ref1?++j:--j){this.selY.add(""+y,""+y)}};WeatherControlView.prototype.updateDate=function(){var d,d0,d1,h0,h1,hasNext,hasPrev,m0,m1,tMax,tMin;this.updateSelY();d=this.ctl.getTime();document.title="天気データマップ "+(d.year()+"年"+d.mon()+"月"+d.day()+"日"+d.hour()+"時");tMin=DataInfo.timeMin();tMax=DataInfo.timeMax();m0=d.sameYear(tMin)?tMin.mon():1;m1=d.sameYear(tMax)?tMax.mon():12;updateSelectRange(this.selM,m0,m1);d0=d.sameMon(tMin)?tMin.day():1;d1=d.sameMon(tMax)?tMax.day():d.daysOfMon();updateSelectRange(this.selD,d0,d1);h0=d.sameDay(tMin)?1:0;h1=d.sameDay(tMax)?0:23;updateSelectRange(this.selH,h0,h1);this.selY.select(d.year());this.selM.select(d.mon());this.selD.select(d.day());this.selH.select(d.hour());hasPrev=!d.sameHour(tMin);hasNext=!d.sameHour(tMax);if(IS_PC){this.prevY.enable(hasPrev);this.nextY.enable(hasNext);this.prevM.enable(hasPrev);this.nextM.enable(hasNext)}this.prevD.enable(hasPrev);this.nextD.enable(hasNext);this.prevH.enable(hasPrev);return this.nextH.enable(hasNext)};WeatherControlView.prototype.update=function(success){if(!(success&&this.ctl.getData()!=null)){return}this.updateDate();if(this.ctl.isLastFrame()){return this.updatePlayButton("last")}else{return this.updatePlayButton(this.ctl.interval!=null?"stop":"play")}};WeatherControlView.prototype.onUpdateData=function(){return this.update(true)};WeatherControlView.prototype.selectDate=function(){return this.ctl.setTime(Date.YMDH(parseInt(this.selY.value()),parseInt(this.selM.value()),parseInt(this.selD.value()),parseInt(this.selH.value())))};WeatherControlView.prototype.buttonPrevY=function(){return this.ctl.setTime(this.ctl.getTime().prevYear())};WeatherControlView.prototype.buttonNextY=function(){return this.ctl.setTime(this.ctl.getTime().nextYear())};WeatherControlView.prototype.buttonPrevM=function(){return this.ctl.setTime(this.ctl.getTime().prevMon())};WeatherControlView.prototype.buttonNextM=function(){return this.ctl.setTime(this.ctl.getTime().nextMon())};WeatherControlView.prototype.buttonPrevD=function(){return this.ctl.setTime(this.ctl.getTime().prevDay())};WeatherControlView.prototype.buttonNextD=function(){return this.ctl.setTime(this.ctl.getTime().nextDay())};WeatherControlView.prototype.buttonPrevH=function(){return this.ctl.setTime(this.ctl.getTime().prevHour())};WeatherControlView.prototype.buttonNextH=function(){return this.ctl.setTime(this.ctl.getTime().nextHour())};WeatherControlView.prototype.buttonPlay=function(){if(this.ctl.interval!=null){this.weatherView.stop();return this.updatePlayButton("play")}else{this.weatherView.play();return this.updatePlayButton("stop")}};WeatherControlView.prototype.selectA=function(){return this.weatherView.setOption("a",parseInt(this.selA.value()))};WeatherControlView.prototype.radioC=function(i){var c;c=CIRCLE_TYPE[i];this.weatherView.setOption("c",c);return this.disp.setGrad(c)};WeatherControlView.prototype.selectC=function(){var c;c=this.selC.value();this.weatherView.setOption("c",c);return this.disp.setGrad(c)};WeatherControlView.prototype.selectS=function(){var sz;sz=parseInt(this.selS.value());this.weatherView.setOption("s",sz);this.radC.enable(sz!==0);return this.disp.setGrad(sz!==0?this.option.c:null)};WeatherControlView.prototype.selectW=function(){var sz;sz=parseInt(this.selW.value());return this.weatherView.setOption("w",sz)};WeatherControlView.prototype.updatePlayButton=function(state){switch(state){case"play":case"last":return this.play.enable(state==="play").setText("&nbsp;再生&nbsp;").setHighlight("regular");case"stop":return this.play.enable(true).setText("&nbsp;停止&nbsp;").setHighlight("highlight")}};WeatherControlView.prototype.saveURL=function(){var center,map;map=this.weatherView.getMap();center=map.getCenter();return window.location.hash="#"+("ll="+center.lat().toFixed(5)+","+center.lng().toFixed(5)+"&")+("z="+map.getZoom()+"&t="+map.getMapTypeId()+"&")+("d="+this.dateQueryString()+"&a="+this.option.a+"&")+("c="+this.option.c+"&s="+this.option.s+"&w="+this.option.w+"&")+this.infoView.getQuery()};WeatherControlView.prototype.showInfo=function(id){return this.infoView.showPlace(id)};WeatherControlView.prototype.closeInfo=function(){return this.weatherView.eraseMarker()};return WeatherControlView}();window.WeatherControlView=WeatherControlView}).call(this);(function(){var DIR,INFO_HEIGHT,INFO_TOP,PopupInfoView,SVGNS;SVGNS=window.SVGNS;DIR=DataInfo.WIND_DIRECTION;INFO_TOP=24;INFO_HEIGHT=16;PopupInfoView=function(){PopupInfoView.prototype.createCaption=function(i,text){return $("<span class='popupCaption'>"+text+"</span>").css({top:INFO_TOP+i*INFO_HEIGHT}).appendTo(this.div)};PopupInfoView.prototype.createText=function(i){return $("<span class='popupValue' />").css({top:INFO_TOP+i*INFO_HEIGHT}).appendTo(this.div)};function PopupInfoView(parent){var captions,i,j,ref,vars;this.parent=$(parent);this.div=$("<div class='popupInfo' />");this.attached=false;this.name=$("<span class='popupPlaceName' />").appendTo(this.div);captions=["気温","降水量","風速","風向","日照時間","降雪量","積雪量","緯度","経度","標高"];vars=["temp","prec","vel","dir","sun","fall","depth","lat","lon","alt"];for(i=j=0,ref=captions.length;0<=ref?j<ref:j>ref;i=0<=ref?++j:--j){this.createCaption(i,captions[i]);this[vars[i]]=this.createText(i)}this.attach()}PopupInfoView.prototype.moveTo=function(x,y){this.div.css({left:x,top:y})};PopupInfoView.prototype.setInfo=function(id,place,data){this.name.empty().append(place.name);if(data!=null&&data[1]!=null){this.temp.empty().append(data[1].toFixed(1)+" ℃")}else{this.temp.empty().append("---")}if(data!=null&&data[0]!=null){this.prec.empty().append(data[0].toFixed(1)+" mm/時")}else{this.prec.empty().append("---")}if(data!=null&&data[2]!=null){this.vel.empty().append(data[2].toFixed(1)+" m/s")}else{this.vel.empty().append("---")}if(data!=null&&data[3]!=null){this.dir.empty().append(DIR[data[3]])}else{this.dir.empty().append("---")}if(data!=null&&data[4]!=null){this.sun.empty().append(data[4].toFixed(1)+" 時間")}else{this.sun.empty().append("---")}if(data!=null&&data[5]!=null){this.fall.empty().append(data[5]+" cm")}else{this.fall.empty().append("---")}if(data!=null&&data[6]!=null){this.depth.empty().append(data[6]+" cm")}else{this.depth.empty().append("---")}this.lat.empty().append(place.lat.toFixed(3));this.lon.empty().append(place.lon.toFixed(3));this.alt.empty().append(place.alt.toFixed(id>=1e4?1:0)+" m")};PopupInfoView.prototype.attach=function(){if(!this.attached){this.div.appendTo(this.parent);this.attached=true}};PopupInfoView.prototype.detach=function(){if(this.attached){this.div.detach();this.attached=false}};return PopupInfoView}();window.PopupInfoView=PopupInfoView}).call(this);(function(){var CIRCLE_DATA_INDEX,CIRCLE_GRADIENT,EastBound,NorthBound,PLACES,RE_DATE,SVGNS,SouthBound,WIND_DATA_INDEX,WeatherView,WestBound,animationInterval,circleScale,dotFill,dotFillGray,dotScale,renderSize,rotWind,round,sizeScale,windFill,windPath,windScale,windStroke,windStrokeLineCap,windStrokeLineJoin,windStrokeWidth,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;round=Math.round;SVGNS=window.SVGNS;NorthBound=47;SouthBound=-71;WestBound=39;EastBound=156;renderSize=function(x){if(x<1){return(""+x).slice(0,5)}else if(x>=100){return""+(x>>0)}else{return(""+x).slice(0,4)}};dotScale=Presentation.scale.dot;circleScale=Presentation.scale.circle;windScale=Presentation.scale.wind;sizeScale=Presentation.scale.size;dotFill=Presentation.fill.dot.regular;dotFillGray=Presentation.fill.dot.grayed;CIRCLE_GRADIENT={t:Presentation.gradient.temp,p:Presentation.gradient.prec,s:Presentation.gradient.sun,f:Presentation.gradient.fall,d:Presentation.gradient.depth};windFill=Presentation.path.wind.fill;windStroke=Presentation.path.wind.stroke;windStrokeWidth=Presentation.path.wind.strokeWidth;windStrokeLineCap=Presentation.path.wind.strokeLineCap;windStrokeLineJoin=Presentation.path.wind.strokeLineJoin;windPath=Presentation.path.wind.render;rotWind=function(){var i,rotations;rotations=function(){var k,results;results=[];for(i=k=0;k<16;i=++k){results.push("rotate("+i*22.5+")")}return results}();rotations.push("rotate(0)");return rotations}();animationInterval=Presentation.animation.interval;CIRCLE_DATA_INDEX={p:0,t:1,s:4,f:5,d:6};WIND_DATA_INDEX=[2,3];RE_DATE=/(\d{4})(\d\d)(\d\d)(\d\d)(\d\d)/;PLACES=Places;WeatherView=function(superClass){extend(WeatherView,superClass);function WeatherView(canvasId,map,option){var t0;WeatherView.__super__.constructor.call(this,canvasId,map,NorthBound,SouthBound,WestBound,EastBound);this.ctl=new WeatherController(this);this.ctlView=new WeatherControlView(this);t0=DataInfo.timeMax();if(t0.hour()<12){t0=t0.prevDay()}t0=Date.YMDH(t0.year(),t0.mon(),t0.day(),12);this.option={c:"t",s:2,w:2,a:1,d:t0};this.processOption(option);return}WeatherView.prototype.processOption=function(option){this.ctlView.processOption(option,this.option);if(this.svg!=null){this.updateElements()}this.ctl.setTime(this.option.d)};WeatherView.prototype.onAdd=function(){WeatherView.__super__.onAdd.apply(this,arguments);this.createElements()};WeatherView.prototype.draw=function(){WeatherView.__super__.draw.apply(this,arguments);this.updateElements();if(this.popupId!=null){this.updatePopup(this.popupId)}};WeatherView.prototype.play=function(){this.ctl.setAnim(animationInterval[this.option.a])};WeatherView.prototype.stop=function(){this.ctl.setAnim(null)};WeatherView.prototype.setOption=function(key,value){if(this.option[key]!==value){this.option[key]=value;if(key==="a"){if(this.ctl.interval()!=null){this.play()}}else{this.updateElements()}}};WeatherView.prototype.createElements=function(){var circle,g,id,obj,place,point,wind;this.places=function(){var results;results=[];for(id in PLACES){place=PLACES[id];this.svg.appendChild(g=document.createElementNS(SVGNS,"g"));g.appendChild(circle=document.createElementNS(SVGNS,"circle"));circle.setAttribute("cx","0");circle.setAttribute("cy","0");circle.setAttribute("stroke","none");g.appendChild(wind=document.createElementNS(SVGNS,"path"));wind.setAttribute("fill",windFill);wind.setAttribute("stroke",windStroke);wind.setAttribute("stroke-width",windStrokeWidth);wind.setAttribute("stroke-linecap",windStrokeLineCap);wind.setAttribute("stroke-linejoin",windStrokeLineJoin);g.appendChild(point=document.createElementNS(SVGNS,"circle"));point.setAttribute("cx","0");point.setAttribute("cy","0");point.setAttribute("stroke","none");results.push(obj={id:id,g:g,circle:circle,wind:wind,point:point,lat:place.lat,lon:place.lon})}return results}.call(this)};WeatherView.prototype.updateElements=function(){var c,circleR,k,l,len,len1,place,pointR,proj,pt,ref,ref1,x0,y0;proj=this.getProjection();x0=this.origin.x;y0=this.origin.y;pointR=renderSize(dotScale[this.zoom]);circleR=renderSize(circleScale[this.zoom]*sizeScale[this.option.s]);if(this.zoom<10){ref=this.places;for(k=0,len=ref.length;k<len;k++){place=ref[k];pt=new google.maps.LatLng(place.lat,place.lon);c=proj.fromLatLngToDivPixel(pt);if(c.x<x0){c.x+=this.pxEarthW}place.g.setAttribute("transform","translate("+(""+(c.x-x0)).slice(0,7)+","+(""+(c.y-y0)).slice(0,7)+")");place.point.setAttribute("r",pointR);place.circle.setAttribute("r",circleR)}}else{ref1=this.places;for(l=0,len1=ref1.length;l<len1;l++){place=ref1[l];pt=new google.maps.LatLng(place.lat,place.lon);c=proj.fromLatLngToDivPixel(pt);if(c.x<x0){c.x+=this.pxEarthW}place.g.setAttribute("transform","translate("+(c.x-x0>>0)+","+(c.y-y0>>0)+")");place.point.setAttribute("r",pointR);place.circle.setAttribute("r",circleR)}}this.updatePoint();this.updateCircle();this.updateWind();this.updateMarker()};WeatherView.prototype.update=function(sender,success){this.ctlView.update(success);if(this.svg!=null){this.updatePoint();this.updateCircle();this.updateWind();this.updateMarker();if(this.popupId!=null){this.updatePopup(this.popupId)}}};WeatherView.prototype.updatePoint=function(){var d,data,i,indices,j,k,l,len,len1,place,ref,ref1;indices=[];data=this.ctl.getData();if(data!=null){if(this.option.s>0){indices.push(CIRCLE_DATA_INDEX[this.option.c])}if(this.option.w>0){indices.push(WIND_DATA_INDEX[0])}}if(indices.length===0){ref=this.places;for(k=0,len=ref.length;k<len;k++){place=ref[k];place.point.setAttribute("fill",dotFillGray)}}else{i=j=indices[0];if(indices.length===2){j=indices[1]}ref1=this.places;for(l=0,len1=ref1.length;l<len1;l++){place=ref1[l];d=data[place.id];if(d&&(d[i]!=null||d[j]!=null)){place.point.setAttribute("fill",dotFill)}else{place.point.setAttribute("fill",dotFillGray)}}}};WeatherView.prototype.updateCircle=function(){var d,data,g,i,k,l,len,len1,place,ref,ref1;if(this.option.s>0&&(data=this.ctl.getData())!=null){i=CIRCLE_DATA_INDEX[this.option.c];g=CIRCLE_GRADIENT[this.option.c];ref=this.places;for(k=0,len=ref.length;k<len;k++){place=ref[k];d=data[place.id];place.circle.setAttribute("fill",g(d!=null?d[i]:null))}}else{ref1=this.places;for(l=0,len1=ref1.length;l<len1;l++){place=ref1[l];place.circle.setAttribute("fill","none")}}};WeatherView.prototype.updateWind=function(){var d,data,k,l,len,len1,noPath,place,r,ref,ref1,scale,v,wind;noPath=windPath(null);if(this.option.w>0&&(data=this.ctl.getData())!=null){scale=renderSize(windScale[this.zoom]*sizeScale[this.option.w]);scale="scale("+scale+","+scale+") ";v=WIND_DATA_INDEX[0],r=WIND_DATA_INDEX[1];ref=this.places;for(k=0,len=ref.length;k<len;k++){place=ref[k];wind=place.wind;d=data[place.id];if(d!=null&&d[v]!=null&&d[r]!=null){wind.setAttribute("d",windPath(d[v]));wind.setAttribute("transform",scale+rotWind[d[r]])}else{wind.setAttribute("d",noPath)}}}else{ref1=this.places;for(l=0,len1=ref1.length;l<len1;l++){place=ref1[l];place.wind.setAttribute("d",noPath)}}};WeatherView.prototype.updateMarker=function(){var place;if(this.markerId!=null){place=PLACES[this.markerId];if(this.marker==null){this.marker=new google.maps.Marker({position:new google.maps.LatLng(place.lat,place.lon),map:this.getMap(),title:place.name})}else{this.marker.setMap(this.getMap());this.marker.setPosition(new google.maps.LatLng(place.lat,place.lon));this.marker.setTitle(place.name)}}else{if(this.marker!=null){this.marker.setMap(null)}}};WeatherView.prototype.onClick=function(point){var id;if((id=this.getNearestPlaceId(point))!=null){this.ctlView.showInfo(id);this.markerId=id;this.updateMarker()}};WeatherView.prototype.onMouseMove=function(point){this.updatePopup(this.getNearestPlaceId(point))};WeatherView.prototype.getNearestPlaceId=function(point){var d,dLat,dLon,distance,dx,dy,id,items,k,lat,latLon,len,lon,lonMap,p,placeId,pt;latLon=this.getProjection().fromDivPixelToLatLng(point);lat=latLon.lat();lonMap=LatLonMap[round(lat/LatLonMap.step)];if(lonMap==null){return}lon=latLon.lng();items=lonMap[round(lon/LatLonMap.step)];if(items==null){return}placeId=distance=null;for(k=0,len=items.length;k<len;k++){id=items[k];p=PLACES[id];dLat=lat-p.lat;dLon=lon-p.lon;d=dLat*dLat+dLon*dLon;if(placeId===null||distance>d){placeId=id;distance=d}}if(placeId!=null){p=PLACES[placeId];latLon=new google.maps.LatLng(p.lat,p.lon);pt=this.getProjection().fromLatLngToDivPixel(latLon);dx=point.x-pt.x;dy=point.y-pt.y;if(dx*dx+dy*dy>1600){placeId=null}}return placeId};WeatherView.prototype.updatePopup=function(id){var data,latLon,place,xy;this.popupId=id;if(id!=null){if(this.popup==null){this.popup=new PopupInfoView(this.div)}this.popup.attach();place=PLACES[id];data=this.ctl.getData()[id];this.popup.setInfo(id,place,data);latLon=new google.maps.LatLng(place.lat,place.lon);xy=this.getProjection().fromLatLngToDivPixel(latLon);if(xy.x<this.origin.x){xy+=this.pxEarthW}this.popup.moveTo(xy.x-this.origin.x,xy.y-this.origin.y)}else if(this.popup!=null){this.popup.detach()}};WeatherView.prototype.showMarker=function(id){this.markerId=id;this.updateMarker()};WeatherView.prototype.onUpdateData=function(){this.ctlView.onUpdateData()};WeatherView.prototype.onHashChange=function(){var option;option=OptionParser.parseHash();this.processGoogleMapsOption(option);this.processOption(option)};WeatherView.prototype.processGoogleMapsOption=function(option){var map,opt;opt=OptionParser.processGoogleMapsOption(option);map=this.getMap();if(opt.lat!=null){map.setCenter(new google.maps.LatLng(opt.lat,opt.lon))}if(opt.zoom!=null){map.setZoom(opt.zoom)}if(opt.type!=null){map.setMapTypeId(opt.type)}};return WeatherView}(GoogleMapsOverlaySvg);window.WeatherView=WeatherView}).call(this);(function(){var frame,gmOption,map,option,view;option=OptionParser.parseUrlOption();gmOption=OptionParser.processGoogleMapsOption(option);map=new google.maps.Map(document.getElementById("map"),{minZoom:gmOption.ZoomMin,maxZoom:gmOption.ZoomMax,zoom:gmOption.zoom,mapTypeId:gmOption.type,center:new google.maps.LatLng(gmOption.lat,gmOption.lon),scaleControl:true});if(Modernizr.inlinesvg){view=new WeatherView("map",map,option);window.onhashchange=function(_this){return function(){return view.onHashChange()}}(this)}else{frame=$("<div class='tenki-alert'> <p>天気データマップの実行にはインラインSVGをサポートするブラウザが必要です(このブラウザでは動作しません)。</p> <p><a id='aboutThisApplication' href='https://github.com/higuma/tenki-data-map'>天気データマップについて...</a></p> </div>")[0];frame.index=1;map.controls[google.maps.ControlPosition.TOP_CENTER].push(frame)}}).call(this);
